
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obiwan.priors &#8212; obiwan 1.2.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for obiwan.priors</h1><div class="highlight"><pre>
<span></span><span class="c1"># See LICENSE.rst for BSD 3-clause license info</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">====================</span>
<span class="sd">obiwan.priors</span>
<span class="sd">====================</span>

<span class="sd">Uses intrinsic (dust removed) AB fluxes/mags to select ELGs,LRGs,QSOs,STARs</span>
<span class="sd">Makes color-color plots that reproduce the FDR</span>
<span class="sd">Single band, mag distributions, plotted using &#39;as observed&#39; AB fluxes/mags,</span>
<span class="sd">since these are what one adds into a CP image</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="c1">#from astropy.table import vstack, Table</span>
<span class="kn">from</span> <span class="nn">astrometry.util.fits</span> <span class="k">import</span> <span class="n">fits_table</span><span class="p">,</span> <span class="n">merge_tables</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">newton</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">KernelDensity</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">KNeighborsClassifier</span>

<span class="kn">from</span> <span class="nn">theValidator.catalogues</span> <span class="k">import</span> <span class="n">CatalogueFuncs</span><span class="p">,</span><span class="n">Matcher</span>

<span class="k">class</span> <span class="nc">EmptyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="KernelOfTruth"><a class="viewcode-back" href="../../index.html#obiwan.priors.KernelOfTruth">[docs]</a><span class="k">class</span> <span class="nc">KernelOfTruth</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Kernel Density Estimate for galaxy sample</span>
<span class="sd">    </span>
<span class="sd">    Following http://scikit-learn.org/stable/auto_examples/neighbors/</span>
<span class="sd">    plot_kde_1d.html</span>

<span class="sd">	Args:</span>
<span class="sd">		data_list: list of N features, each element is np.array of M samples</span>
<span class="sd">		labels: list of strings, a name for each of the N feature</span>
<span class="sd">		lims: list of tuples giving low,hi limits for KDE</span>
<span class="sd">		bandwidth: characteristic width of the kernel</span>
<span class="sd">		kernel: gaussian, tophat, etc</span>
<span class="sd">		kdefn: file to save KDE fit to</span>
<span class="sd">		loadkde: boolean, load existing KDE fit if exists</span>

<span class="sd">    Attributes:</span>
<span class="sd">        X: Data to fit KDE to</span>
<span class="sd">        kde: KernelDensity() object</span>
<span class="sd">    &quot;&quot;&quot;</span>
	
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_list</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">lims</span><span class="p">,</span>\
                 <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>\
                 <span class="n">kdefn</span><span class="o">=</span><span class="s1">&#39;kde.pickle&#39;</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fits a KDE to the data&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="o">=</span> <span class="n">kdefn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="o">=</span> <span class="n">loadkde</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">=</span> <span class="n">kernel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span><span class="o">=</span> <span class="n">bandwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="c1"># Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">))</span>
        <span class="c1"># Limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_plot</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lims</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_plot</span><span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">lims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_plot</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_plot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_plot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lims</span><span class="p">))</span>
        <span class="c1"># KDE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kde</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">:</span>
            <span class="n">fout</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">kde</span><span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loaded kde: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">kde</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fit kde&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kde.pickle&#39;</span><span class="p">):</span>
        <span class="n">fout</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="p">,</span><span class="n">fout</span><span class="p">)</span>
        <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># 1D histograms of each dim of KDE</span>
    <span class="k">def</span> <span class="nf">plot_indiv_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="c1"># Data</span>
            <span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="c1"># KDE distribution</span>
            <span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lims</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
            <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;kde_1d_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>

    <span class="c1"># 2D scatterplot of selected dims of KDE</span>
    <span class="k">def</span> <span class="nf">plot_indiv_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xy_names</span><span class="p">,</span><span class="n">xy_lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">nb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xy_names</span><span class="p">):</span>
            <span class="n">xname</span><span class="o">=</span> <span class="n">xy_names</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yname</span><span class="o">=</span> <span class="n">xy_names</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ix</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">xname</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">iy</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">yname</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Plot</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">ix</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">iy</span><span class="p">],</span>
                          <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">ix</span><span class="p">],</span><span class="n">samp</span><span class="p">[:,</span><span class="n">iy</span><span class="p">],</span>
                          <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xname</span><span class="p">)</span>
                <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yname</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xy_lims</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xy_lims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xy_lims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
            <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;kde_2d_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">xname</span><span class="p">,</span><span class="n">yname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outdir</span><span class="p">:</span>
                <span class="n">savenm</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">savenm</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nb</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">plot_FDR_using_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">,</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">obj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;LRG&#39;</span><span class="p">,</span><span class="s1">&#39;ELG&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">use_data</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">]:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="c1"># Add box</span>
            <span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">lower</span><span class="p">()],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
            <span class="c1"># xyrange dashed box</span>
            <span class="c1">#for i in range(2):</span>
            <span class="c1">#    ax[i].plot([xrange[i],xrange[i]],yrange,&#39;k--&#39;)</span>
            <span class="c1">#    ax[i].plot(xrange,[yrange[i],yrange[i]],&#39;k--&#39;)</span>
            <span class="c1"># KDE sample</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
                <span class="n">xname</span><span class="o">=</span> <span class="s1">&#39;rz&#39;</span>
                <span class="n">yname</span><span class="o">=</span> <span class="s1">&#39;rw1&#39;</span>
            <span class="k">elif</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
                <span class="n">xname</span><span class="o">=</span> <span class="s1">&#39;rz&#39;</span>
                <span class="n">yname</span><span class="o">=</span> <span class="s1">&#39;gr&#39;</span>
            <span class="n">ix</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">xname</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">iy</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">yname</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">use_data</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">ix</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">iy</span><span class="p">],</span>
                           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;kde_in_FDR_Data_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">ix</span><span class="p">],</span><span class="n">samp</span><span class="p">[:,</span><span class="n">iy</span><span class="p">],</span>
                           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">)</span>
                <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;kde_in_FDR_KDE_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
            <span class="c1"># finish</span>
            <span class="c1">#ax.set_xlim(xrange[0]-1,xrange[1]+1)</span>
            <span class="c1">#ax.set_ylim(yrange[0]-1,yrange[1]+1)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
                <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
                <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
                <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
                <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outdir</span><span class="p">:</span>
                <span class="n">savenm</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">savenm</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nb</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<div class="viewcode-block" id="KernelOfTruth.plot_1band_and_color"><a class="viewcode-back" href="../../index.html#obiwan.priors.KernelOfTruth.plot_1band_and_color">[docs]</a>    <span class="k">def</span> <span class="nf">plot_1band_and_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xylims -- dict of x1,y1,x2,y2,... where x1 is tuple of low,hi for first plot xaxis&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># Data</span>
        <span class="n">xyz</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>\
                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># KDE distribution</span>
        <span class="n">xyz</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>\
                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;lrg_&#39;</span><span class="p">:</span>
            <span class="c1"># plot g band distribution even though no Targeting cuts on g</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">])</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">g_kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="KernelOfTruth.plot_1band_color_and_redshift"><a class="viewcode-back" href="../../index.html#obiwan.priors.KernelOfTruth.plot_1band_color_and_redshift">[docs]</a>    <span class="k">def</span> <span class="nf">plot_1band_color_and_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xylims -- dict of x1,y1,x2,y2,... where x1 is tuple of low,hi for first plot xaxis&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># Colormap the color-color plot by redshift</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
        <span class="n">bounds</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="c1"># Data</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># color bar with color plot</span>
        <span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span>\
                                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>\
                                 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
                                 <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
                             <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
        <span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#Xtest= np.linspace(-0.2,1.6,num=100)</span>
        <span class="c1">#log_dens = self.kde.score_samples(self.X)</span>
        <span class="c1">#ax[0,2].plot(self.X[:,3], np.exp(log_dens), &#39;y-&#39;)</span>
        <span class="c1"># KDE distribution</span>
        <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>\
                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
        <span class="n">sname</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">sname</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;lrg_&#39;</span><span class="p">:</span>
            <span class="c1"># plot g band distribution even though no Targeting cuts on g</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x4&#39;</span><span class="p">])</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">sname</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">g_kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">sname</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sname</span><span class="p">)</span></div>

<div class="viewcode-block" id="KernelOfTruth.plot_galaxy_shapes"><a class="viewcode-back" href="../../index.html#obiwan.priors.KernelOfTruth.plot_galaxy_shapes">[docs]</a>    <span class="k">def</span> <span class="nf">plot_galaxy_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kde.png&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xylims -- dict of x1,y1,x2,y2,... where x1 is tuple of low,hi for first plot xaxis&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="c1"># ba,pa can be slightly greater 1.,180</span>
        <span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span> <span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.</span> <span class="p">]</span><span class="o">=</span> <span class="mf">1.</span>
        <span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">][</span> <span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">180.</span> <span class="p">]</span><span class="o">=</span> <span class="mf">180.</span>
        <span class="c1"># Physical values</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span>\
                      <span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span>\
                      <span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">)))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span>\
                      <span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">)))</span>
        <span class="c1"># plot</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="c1"># Data</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># KDE distribution</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># lims</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                    <span class="c1">#ax[cnt,1].set_xlim(xylims[&#39;x2&#39;])</span>
                    <span class="c1">#ax[cnt,2].set_xlim(xylims[&#39;x3&#39;])</span>
                    <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
                    <span class="c1">#xlab=ax[cnt,1].set_xlabel(self.labels[1],fontsize=&#39;x-large&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="_GaussianMixtureModel"><a class="viewcode-back" href="../../index.html#obiwan.priors._GaussianMixtureModel">[docs]</a><span class="k">class</span> <span class="nc">_GaussianMixtureModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sample from a Mixture of Gaussians (MoG) with known params</span>
<span class="sd">    </span>
<span class="sd">	Args:</span>
<span class="sd">		weights_,means_,covars_: MoG parameters</span>
<span class="sd">		covtype: &#39;spherical&#39;, &#39;diag&#39;, &#39;tied&#39;, &#39;full&#39;</span>

<span class="sd">	Attributes:</span>
<span class="sd">		weights_,means_,covars_: MoG parameters</span>
<span class="sd">		covtype: &#39;spherical&#39;, &#39;diag&#39;, &#39;tied&#39;, &#39;full&#39;</span>
<span class="sd">		n_components: as sounds</span>
<span class="sd">		n_dimenstions: as sounds</span>
<span class="sd">    &quot;&quot;&quot;</span>
	
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights_</span><span class="p">,</span> <span class="n">means_</span><span class="p">,</span> <span class="n">covars_</span><span class="p">,</span> <span class="n">covtype</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights_</span> <span class="o">=</span> <span class="n">weights_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">means_</span> <span class="o">=</span> <span class="n">means_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covars_</span> <span class="o">=</span> <span class="n">covars_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covtype</span> <span class="o">=</span> <span class="n">covtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="o">.</span><span class="n">shape</span>
    
<div class="viewcode-block" id="_GaussianMixtureModel.save"><a class="viewcode-back" href="../../index.html#obiwan.priors._GaussianMixtureModel.save">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;index: optional nddex array for subset of compenents to save&quot;&quot;&quot;</span>
        <span class="n">hdus</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">()</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
        <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;covtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">covariance_type</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">weights_</span><span class="p">))</span>
        <span class="n">hdus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">weights_</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;weights_&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">hdr</span><span class="p">))</span>
        <span class="n">hdus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">means_</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;means_&#39;</span><span class="p">))</span>
        <span class="n">hdus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">covars_</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;covars_&#39;</span><span class="p">))</span>
        <span class="n">hdus</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
        
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">hdus</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">hdus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">covtype</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;covtype&#39;</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">_GaussianMixtureModel</span><span class="p">(</span>
            <span class="n">hdus</span><span class="p">[</span><span class="s1">&#39;weights_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdus</span><span class="p">[</span><span class="s1">&#39;means_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdus</span><span class="p">[</span><span class="s1">&#39;covars_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">covtype</span><span class="p">)</span>
        <span class="n">hdus</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model</span>
    
    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covtype</span> <span class="o">!=</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;covariance type &quot;</span><span class="si">{0}</span><span class="s1">&quot; not implemented yet.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covtype</span><span class="p">))</span>
        
        <span class="c1"># Code adapted from sklearn&#39;s GMM.sample()</span>
        <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>

        <span class="n">weight_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span><span class="p">))</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
        <span class="c1"># decide which component to use for each sample</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="n">weight_cdf</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">rand</span><span class="p">)</span>
        <span class="c1"># for each component, generate all needed samples</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
            <span class="c1"># occurrences of current component in X</span>
            <span class="n">comp_in_X</span> <span class="o">=</span> <span class="p">(</span><span class="n">comp</span> <span class="o">==</span> <span class="n">comps</span><span class="p">)</span>
            <span class="c1"># number of those occurrences</span>
            <span class="n">num_comp_in_X</span> <span class="o">=</span> <span class="n">comp_in_X</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">num_comp_in_X</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">comp_in_X</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="p">[</span><span class="n">comp</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">covars_</span><span class="p">[</span><span class="n">comp</span><span class="p">],</span> <span class="n">num_comp_in_X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>
    
<div class="viewcode-block" id="_GaussianMixtureModel.sample_full_pdf"><a class="viewcode-back" href="../../index.html#obiwan.priors._GaussianMixtureModel.sample_full_pdf">[docs]</a>    <span class="k">def</span> <span class="nf">sample_full_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&#39;sample() uses the component datum x is closest too, sample_full_pdf() uses sum of components at datum x</span>
<span class="sd">        this is more time consuming than sample() and difference is negligible&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covtype</span> <span class="o">!=</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;covariance type &quot;</span><span class="si">{0}</span><span class="s1">&quot; not implemented yet.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covtype</span><span class="p">))</span>

        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">multivariate_normal</span>
        <span class="k">def</span> <span class="nf">get_mv</span><span class="p">(</span><span class="n">means_</span><span class="p">,</span><span class="n">covars_</span><span class="p">):</span>
            <span class="n">mv</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">mu</span><span class="p">,</span> <span class="n">C</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">means_</span><span class="p">,</span> <span class="n">covars_</span><span class="p">):</span>
                <span class="n">mv</span><span class="o">+=</span> <span class="p">[</span> <span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">C</span><span class="p">)</span> <span class="p">]</span>
            <span class="k">return</span> <span class="n">mv</span>
                
        <span class="k">def</span> <span class="nf">prob_map</span><span class="p">(</span><span class="n">means_</span><span class="p">,</span><span class="n">covars_</span><span class="p">,</span><span class="n">weights_</span><span class="p">,</span>\
                     <span class="n">xrng</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span><span class="n">yrng</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span><span class="n">npts</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;returns </span>
<span class="sd">            -pmap: 2d probability map, with requirement that integral(pdf d2x) within 1% of 1</span>
<span class="sd">            -xvec,yvec: vectors where x[ix] and y[ix] data points have probability pmap[ix,iy]&quot;&quot;&quot;</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">xrng</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xrng</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">yrng</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yrng</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xstep</span><span class="o">=</span> <span class="p">(</span><span class="n">xrng</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xrng</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">npts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ystep</span><span class="o">=</span> <span class="p">(</span><span class="n">yrng</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yrng</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">npts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xrng</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xrng</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xstep</span><span class="p">:</span><span class="n">xstep</span><span class="p">,</span> <span class="n">yrng</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">yrng</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ystep</span><span class="p">:</span><span class="n">ystep</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span> <span class="c1">#npts x npts x 2</span>
            <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">maps</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights_</span><span class="p">),))</span> <span class="c1"># x n_components</span>
            <span class="c1"># Multi-Variate function</span>
            <span class="n">mv</span><span class="o">=</span> <span class="n">get_mv</span><span class="p">(</span><span class="n">means_</span><span class="p">,</span><span class="n">covars_</span><span class="p">)</span>
            <span class="c1"># probability map for each component</span>
            <span class="k">for</span> <span class="n">dist</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">cnt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span><span class="n">weights_</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights_</span><span class="p">))):</span>
                <span class="n">maps</span><span class="p">[:,:,</span><span class="n">cnt</span><span class="p">]</span><span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span>
                <span class="nb">print</span> <span class="s2">&quot;map </span><span class="si">%d</span><span class="s2">, dist.pdf max=</span><span class="si">%.2f</span><span class="s2">, wt=</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="p">,</span><span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">W</span><span class="p">)</span>
            <span class="c1"># summed prob map</span>
            <span class="n">pmap</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">maps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#some over components*weights</span>
            <span class="n">xvec</span><span class="o">=</span> <span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yvec</span><span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="c1"># intregal of pdf over 2d map = 1</span>
        <span class="c1">#     assert( abs(1.- pmap.sum()*xstep*ystep) &lt;= 0.01 )</span>
            <span class="k">assert</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pmap</span><span class="p">,</span> <span class="n">xvec</span><span class="p">,</span><span class="n">yvec</span>
            
        <span class="c1"># 2D probability map</span>
        <span class="n">grrange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">rzrange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">pmap</span><span class="p">,</span><span class="n">xvec</span><span class="p">,</span><span class="n">yvec</span><span class="o">=</span> <span class="n">prob_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">covars_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="p">,</span>\
                                 <span class="n">xrng</span><span class="o">=</span><span class="n">rzrange</span><span class="p">,</span><span class="n">yrng</span><span class="o">=</span><span class="n">grrange</span><span class="p">)</span>
        <span class="c1"># Sample self.n_dimensions using map</span>
        <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>
        <span class="c1"># Make max pdf = 1 so always pick that cell</span>
        <span class="n">pmap</span><span class="o">/=</span> <span class="n">pmap</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="c1"># Store x,y values to use</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Get samples</span>
        <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span>
        <span class="c1"># pick a random cell</span>
        <span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Random [0,1)</span>
        <span class="n">likely</span><span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">n_samples</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">likely</span> <span class="o">&lt;=</span> <span class="n">pmap</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]:</span> <span class="c1"># Sample it!</span>
                <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">,:]</span><span class="o">=</span> <span class="n">xvec</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span><span class="n">yvec</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span>
                <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
            <span class="c1"># Pick new cell in either case</span>
            <span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> 
            <span class="n">likely</span><span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span></div></div>


<div class="viewcode-block" id="add_MoG_curves"><a class="viewcode-back" href="../../index.html#obiwan.priors.add_MoG_curves">[docs]</a><span class="k">def</span> <span class="nf">add_MoG_curves</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">means_</span><span class="p">,</span> <span class="n">covars_</span><span class="p">,</span> <span class="n">weights_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot 2-sigma ellipses for each multivariate component</span>

<span class="sd">	Args: </span>
<span class="sd">		ax: axis to draw on</span>
<span class="sd">		means_, covars_, weights_: MoG parameters</span>
<span class="sd">	&quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">means_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">means_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">scale</span><span class="o">=</span><span class="mf">2.</span>
    <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">means_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">means_</span><span class="p">,</span> <span class="n">covars_</span><span class="p">,</span> <span class="n">weights_</span><span class="p">):</span>
    <span class="c1">#     draw_ellipse(mu, C, scales=[1.5], ax=ax, fc=&#39;none&#39;, ec=&#39;k&#39;)</span>
        <span class="c1"># Draw MoG outlines</span>
        <span class="n">sigma_x2</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">sigma_y2</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">sigma_xy</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_xy</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">sigma_x2</span> <span class="o">-</span> <span class="n">sigma_y2</span><span class="p">))</span>
        <span class="n">tmp1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma_x2</span> <span class="o">+</span> <span class="n">sigma_y2</span><span class="p">)</span>
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma_x2</span> <span class="o">-</span> <span class="n">sigma_y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">sigma_xy</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">sigma1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp1</span> <span class="o">+</span> <span class="n">tmp2</span><span class="p">)</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp1</span> <span class="o">-</span> <span class="n">tmp2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;comp=</span><span class="si">%d</span><span class="s1">, sigma1=</span><span class="si">%f</span><span class="s1">,sigma2=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">sigma1</span><span class="p">,</span><span class="n">sigma2</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="mi">2</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sigma1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sigma2</span><span class="p">,</span>
                     <span class="n">alpha</span> <span class="o">*</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>\
                     <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">))</span></div>




<span class="k">def</span> <span class="nf">get_rgb_cols</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),(</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span>\
            <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>\
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>

<span class="c1">#def flux2mag(nanoflux):</span>
<span class="c1">#    return 22.5-2.5*np.log10(nanoflux)</span>

<span class="c1"># Globals</span>
<span class="n">xyrange</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_star</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">],</span>\
             <span class="n">y_star</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.</span><span class="p">],</span>\
             <span class="n">x_elg</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">],</span>\
             <span class="n">y_elg</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.</span><span class="p">],</span>\
             <span class="n">x_lrg</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span>\
             <span class="n">y_lrg</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>\
             <span class="n">x1_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.</span><span class="p">],</span>\
             <span class="n">y1_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span>\
             <span class="n">x2_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span>\
             <span class="n">y2_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>

<div class="viewcode-block" id="rm_last_ticklabel"><a class="viewcode-back" href="../../index.html#obiwan.priors.rm_last_ticklabel">[docs]</a><span class="k">def</span> <span class="nf">rm_last_ticklabel</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;for multiplot&quot;&quot;&quot;</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="c1">#prevent from making float</span>
    <span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></div>



<div class="viewcode-block" id="TSBox"><a class="viewcode-back" href="../../index.html#obiwan.priors.TSBox">[docs]</a><span class="k">class</span> <span class="nc">TSBox</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add FDR Target Selection box to any  ELG, LRG, plot</span>
<span class="sd">    </span>
<span class="sd">	Args:</span>
<span class="sd">		src: ELG, LRG, QSO, STAR</span>

<span class="sd">	Attributes:</span>
<span class="sd">		src: ELG, LRG, QSO, STAR</span>
<span class="sd">		</span>
<span class="sd">	Note: </span>
<span class="sd">		add_ts_box(): primary function to use</span>
<span class="sd">	&quot;&quot;&quot;</span>
	
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">=</span><span class="n">src</span>

<div class="viewcode-block" id="TSBox.add_ts_box"><a class="viewcode-back" href="../../index.html#obiwan.priors.TSBox.add_ts_box">[docs]</a>    <span class="k">def</span> <span class="nf">add_ts_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;draw color selection box&quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
            <span class="c1">#g-r vs. r-z</span>
            <span class="n">xint</span><span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_root</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;y1-y2&#39;</span><span class="p">,))</span>
            
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">)</span>
            <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">y</span>
            <span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">y</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.3</span><span class="p">,</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xint</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y1</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xint</span><span class="p">,</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">1.6</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y2</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">y3</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
            <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="o">=</span> <span class="n">x3</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y3</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">y4</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="o">=</span> <span class="n">x4</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y4</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
            <span class="c1">#r-w1 vs. r-z</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">y</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">1.5</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y1</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y2</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;src=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">ts_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="mf">1.15</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="mf">0.15</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y2&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mf">1.2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mf">1.6</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="mf">1.8</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="mf">1.</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;src=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ts_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y1-y2&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;non ELG not supported&#39;</span><span class="p">)</span></div>



<span class="c1">#def elg_data():</span>
<span class="c1">#    &quot;&quot;&quot;Use DEEP2 ELGs whose SEDs have been modeled.&quot;&quot;&quot;</span>
<span class="c1">#    elgs = fits.getdata(&#39;/project/projectdirs/desi/spectro/templates/basis_templates/v2.2/elg_templates_v2.0.fits&#39;, 1)</span>
<span class="c1">#    # Colors</span>
<span class="c1">#    gg = elgs[&#39;DECAM_G&#39;]</span>
<span class="c1">#    rr = elgs[&#39;DECAM_R&#39;]</span>
<span class="c1">#    zz = elgs[&#39;DECAM_Z&#39;]</span>
<span class="c1">#    gr = gg - rr</span>
<span class="c1">#    rz = rr - zz</span>
<span class="c1">#    Xall = np.array([rz, gr]).T</span>
<span class="c1">#    # Cuts</span>
<span class="c1">#    has_morph = elgs[&#39;radius_halflight&#39;] &gt; 0</span>
<span class="c1">#    cuts= dict(has_morph=has_morph) </span>
<span class="c1">#    print(&#39;%d/%d of Fit Template Spectra ELGs have morphologies&#39; % (len(elgs[has_morph]), len(elgs)))</span>
<span class="c1">#    # Morphology</span>
<span class="c1">#    morph= {}</span>
<span class="c1">#    morph[&#39;rz&#39;] = rz[has_morph]</span>
<span class="c1">#    morph[&#39;gr&#39;] = gr[has_morph]</span>
<span class="c1">#    morph[&#39;r50&#39;] = elgs[&#39;RADIUS_HALFLIGHT&#39;][has_morph] #arcsec</span>
<span class="c1">#    morph[&#39;n&#39;] = elgs[&#39;SERSICN&#39;][has_morph]                            </span>
<span class="c1">#    morph[&#39;ba&#39;] = elgs[&#39;AXIS_RATIO&#39;][has_morph] #minor/major</span>
<span class="c1">#    return Xall,cuts,morph                            </span>


<span class="k">class</span> <span class="nc">ReadWrite</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">read_fits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">):</span>
        <span class="c1">#return Table(fits.getdata(fn, 1))</span>
        <span class="k">return</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

<span class="c1">#DR=2,savefig=False,alpha=1.,\</span>
<span class="c1">#brick_primary=True,anymask=False,allmask=False,fracflux=False):</span>
<div class="viewcode-block" id="CommonInit"><a class="viewcode-back" href="../../index.html#obiwan.priors.CommonInit">[docs]</a><span class="k">class</span> <span class="nc">CommonInit</span><span class="p">(</span><span class="n">ReadWrite</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Base class for every STAR,ELG,LRG,QSO class</span>

<span class="sd">	Args:</span>
<span class="sd">		DR: which Data Release&#39;s data to use</span>
<span class="sd">		brick_primary,anymask,allmask,fracflux: booleans for which imaging cuts to use</span>
<span class="sd">		kdefn,loadkde,savekde: where to get the saved KDE fit</span>
<span class="sd">		savefig,alpha,outdir: plotting options </span>

<span class="sd">	Attributes:</span>
<span class="sd">		truth_dir: directory of matched Truth Tables</span>
<span class="sd">		args: ditto above </span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="c1"># Syntax is self.val2 = kwargs.get(&#39;val2&#39;,&quot;default value&quot;)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DR</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DR&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;savefig&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">brick_primary</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">anymask</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;anymask&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">allmask</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allmask&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fracflux</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fracflux&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.fracflux=&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fracflux</span><span class="p">,</span><span class="s1">&#39;kwargs= &#39;</span><span class="p">,</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="o">=</span> <span class="s1">&#39;/project/projectdirs/desi/target/analysis/truth&#39;</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="o">=</span> <span class="s1">&#39;/project/projectdirs/desi/users/burleigh/desi/target/analysis/truth&#39;</span>
		<span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="n">valueerror</span><span class="p">()</span>
		<span class="c1"># KDE params</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kdefn&#39;</span><span class="p">,</span><span class="s1">&#39;kde.pickle&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loadkde&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;savekde&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
		<span class="c1"># </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;outdir&#39;</span><span class="p">,</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
		<span class="c1"># Running from jupyter nb?</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="CommonInit.imaging_cut"><a class="viewcode-back" href="../../index.html#obiwan.priors.CommonInit.imaging_cut">[docs]</a>	<span class="k">def</span> <span class="nf">imaging_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;data is a fits_table object with Tractor Catalogue columns&quot;&quot;&quot;</span>
		<span class="n">cut</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
		<span class="c1"># Brick Primary</span>
		<span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;bool&#39;</span><span class="p">:</span>
			<span class="n">cut</span><span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
		<span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;S1&#39;</span><span class="p">:</span>
			<span class="n">cut</span><span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span>
		<span class="k">else</span><span class="p">:</span> 
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;brick_primary has type=&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
		<span class="c1">#if self.anymask:</span>
		<span class="c1">#    cut*= np.all((data.get(&#39;decam_anymask&#39;)[:, [1,2,4]] == 0),axis=1)</span>
		<span class="c1"># ALL Mask</span>
		<span class="n">cut</span><span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_allmask&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1"># FracFlux</span>
		<span class="n">cut</span><span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_fracflux&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">cut</span></div>

<div class="viewcode-block" id="CommonInit.std_star_cut"><a class="viewcode-back" href="../../index.html#obiwan.priors.CommonInit.std_star_cut">[docs]</a>	<span class="k">def</span> <span class="nf">std_star_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;See: https://desi.lbl.gov/trac/wiki/TargetSelectionWG/TargetSelection#SpectrophotometricStandardStarsFSTD</span>
<span class="sd">		   data is a fits_table object with Tractor Catalogue columns</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">RFLUX_obs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">GFLUX</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">RFLUX</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">ZFLUX</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
		<span class="n">GRZSN</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_ivar&#39;</span><span class="p">)[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
		<span class="n">GRCOLOR</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">RFLUX</span> <span class="o">/</span> <span class="n">GFLUX</span><span class="p">)</span>
		<span class="n">RZCOLOR</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ZFLUX</span> <span class="o">/</span> <span class="n">RFLUX</span><span class="p">)</span>
		<span class="n">cut</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span>\
					 <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;PSF&#39;</span><span class="p">,</span>\
					 <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_allmask&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>\
					 <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_fracflux&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.04</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>\
					 <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">GRZSN</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>\
					 <span class="n">RFLUX_obs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="mf">16.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
					 <span class="c1">#np.power(GRCOLOR - 0.32,2) + np.power(RZCOLOR - 0.13,2) &lt; 0.06**2,\</span>
					 <span class="c1">#RFLUX_obs &gt; 10**((22.5-19.0)/2.5)),axis=0)</span>
		<span class="k">return</span> <span class="n">cut</span> </div></div>

<div class="viewcode-block" id="CrossValidator"><a class="viewcode-back" href="../../index.html#obiwan.priors.CrossValidator">[docs]</a><span class="k">class</span> <span class="nc">CrossValidator</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;Cross validate the RedshiftPredictor() function</span>

<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="CrossValidator.kfold_indices"><a class="viewcode-back" href="../../index.html#obiwan.priors.CrossValidator.kfold_indices">[docs]</a>	<span class="k">def</span> <span class="nf">kfold_indices</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">n_train</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;returns array of indices of shape (k,n_train/k) to grab the k bins of training data&quot;&quot;&quot;</span>
		<span class="n">bucket_sz</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n_train</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
		<span class="n">ind</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">bucket_sz</span><span class="p">)</span> <span class="c1">#robust for any k, even if does not divide evenly!</span>
		<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> 
		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ind</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">bucket_sz</span><span class="p">))</span></div>

<div class="viewcode-block" id="CrossValidator.kfold_cross_val"><a class="viewcode-back" href="../../index.html#obiwan.priors.CrossValidator.kfold_cross_val">[docs]</a>	<span class="k">def</span> <span class="nf">kfold_cross_val</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">kfolds</span><span class="o">=</span><span class="mi">10</span><span class="p">,):</span>
		<span class="sd">&quot;&quot;&quot;C is parameter varying&quot;&quot;&quot;</span>
		<span class="n">nsamples</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">ind</span><span class="o">=</span> <span class="n">kfold_indices</span><span class="p">(</span><span class="n">kfolds</span><span class="p">,</span><span class="n">nsamples</span><span class="p">)</span>
		<span class="n">err</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kfolds</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
		<span class="n">keep_clf</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">err</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kfolds</span><span class="p">):</span>
			<span class="n">ival</span><span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
			<span class="n">itrain</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">ival</span><span class="p">)))</span>
			<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ival</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">itrain</span><span class="p">)))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
			<span class="c1"># Train</span>
			<span class="n">clf</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
			<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">itrain</span><span class="p">,:],</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">itrain</span><span class="p">])</span>
			<span class="c1">#get error for this kth sample</span>
			<span class="n">pred</span><span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">ival</span><span class="p">,:])</span>
			<span class="n">err</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">wrong</span><span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">err</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">keep_clf</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]:</span> 
				<span class="n">keep_clf</span><span class="p">[</span><span class="s1">&#39;lsvc&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">clf</span>
				<span class="n">keep_clf</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">err</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">,</span><span class="n">keep_clf</span></div></div>

<div class="viewcode-block" id="RedshiftPredictor"><a class="viewcode-back" href="../../index.html#obiwan.priors.RedshiftPredictor">[docs]</a><span class="k">class</span> <span class="nc">RedshiftPredictor</span><span class="p">(</span><span class="n">CrossValidator</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Predict redshift instead of using the data&#39;s sample</span>

<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="c1"># All NaNs must be removed</span>
		<span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_nans</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Xtrain</span><span class="o">=</span> <span class="n">X</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ytrain</span><span class="o">=</span> <span class="n">y</span>

	<span class="k">def</span> <span class="nf">svm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clf</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="n">degree</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xtrain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ytrain</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">nn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nn</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">nn</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xtrain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ytrain</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Xtest</span><span class="p">):</span>
		<span class="n">Xtest</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_nans</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">remove_nans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="n">sh</span><span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
		<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">assert</span><span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>    
		<span class="n">X</span><span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">keep</span><span class="p">,:]</span>
		<span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> of X values were NANs, removed these&#39;</span> <span class="o">%</span> \
					<span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
		<span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
			<span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">X</span>


	<span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">):</span>
		<span class="n">k</span><span class="o">=</span><span class="mi">5</span>
		<span class="n">Cvals</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
		<span class="n">avgerr</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Cvals</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">C</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Cvals</span><span class="p">):</span>
			<span class="nb">print</span> <span class="s1">&#39;kfold cv on C= </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">C</span>
			<span class="n">err</span><span class="p">,</span><span class="n">junk</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfold_cross_val</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">kfolds</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
			<span class="nb">print</span> <span class="s1">&#39;err= &#39;</span><span class="p">,</span><span class="n">err</span>
			<span class="n">avgerr</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="nb">print</span> <span class="s1">&#39;avg err= &#39;</span><span class="p">,</span><span class="n">avgerr</span><span class="p">,</span><span class="s1">&#39;C_vals= &#39;</span><span class="p">,</span><span class="n">Cvals</span>
		<span class="n">fout</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cross_validate_svm_</span><span class="si">%s</span><span class="s1">.pickle&#39;</span> <span class="o">%</span> <span class="n">typ</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
		<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">Cvals</span><span class="p">,</span><span class="n">avgerr</span><span class="p">),</span><span class="n">fout</span><span class="p">)</span>
		<span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Cvals</span><span class="p">,</span><span class="n">avgerr</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Cvals</span><span class="p">,</span><span class="n">avgerr</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;C (regularization parameter)&quot;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error rate&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;cross_validate_svm_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">typ</span><span class="p">)</span>
		<span class="n">ibest</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">avgerr</span> <span class="o">==</span> <span class="n">avgerr</span><span class="o">.</span><span class="n">min</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="nb">print</span> <span class="s1">&#39;lowest cross valid error= &#39;</span><span class="p">,</span><span class="n">avgerr</span><span class="p">[</span><span class="n">ibest</span><span class="p">],</span><span class="s1">&#39;for C = &#39;</span><span class="p">,</span><span class="n">Cvals</span><span class="p">[</span><span class="n">ibest</span><span class="p">]</span>	</div>

<span class="k">def</span> <span class="nf">get_acs_six_col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">savedir</span><span class="o">=</span><span class="s1">&#39;/project/projectdirs/desi/users/burleigh/desi/target/analysis/truth&#39;</span>
    <span class="n">savenm</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span><span class="s1">&#39;acs_six_cols.fits&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savenm</span><span class="p">):</span>
        <span class="n">tab</span><span class="o">=</span><span class="n">fits_table</span><span class="p">(</span><span class="n">savenm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">acsfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/project/projectdirs/desi/users/burleigh/desi/target/analysis/truth&#39;</span><span class="p">,</span><span class="s1">&#39;ACS-GC_published_catalogs&#39;</span><span class="p">,</span><span class="s1">&#39;acs_public_galfit_catalog_V1.0.fits.gz&#39;</span><span class="p">)</span>
        <span class="n">acs</span><span class="o">=</span><span class="n">fits_table</span><span class="p">(</span><span class="n">acsfn</span><span class="p">)</span> 
        <span class="c1"># Repackage</span>
        <span class="n">tab</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span><span class="s1">&#39;re_galfit_hi&#39;</span><span class="p">,</span><span class="s1">&#39;n_galfit_hi&#39;</span><span class="p">,</span><span class="s1">&#39;ba_galfit_hi&#39;</span><span class="p">,</span><span class="s1">&#39;pa_galfit_hi&#39;</span><span class="p">]:</span>
            <span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">acs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="c1"># Cuts &amp; clean</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="n">tab</span><span class="o">.</span><span class="n">flag_galfit_hi</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="c1"># -90,+90 --&gt; 0,180 </span>
        <span class="n">tab</span><span class="o">.</span><span class="n">pa_galfit_hi</span> <span class="o">+=</span> <span class="mf">90.</span> 
        <span class="c1"># Save</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">savenm</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tab</span>
 

<div class="viewcode-block" id="ELG"><a class="viewcode-back" href="../../index.html#obiwan.priors.ELG">[docs]</a><span class="k">class</span> <span class="nc">ELG</span><span class="p">(</span><span class="n">CommonInit</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Creates the ELG sample</span>

<span class="sd">	Args: </span>
<span class="sd">		see CommonInit</span>

<span class="sd">	Attributes:</span>
<span class="sd">		rlimit: AB magnitude limit of sample</span>
<span class="sd">		kdefn: name for the fit KDE</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">ELG</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rlimit</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rlimit&#39;</span><span class="p">,</span><span class="mf">23.4</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ELGs, self.rlimit= &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rlimit</span><span class="p">)</span>
		<span class="c1"># KDE params</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="o">=</span> <span class="s1">&#39;elg-kde.pickle&#39;</span>
		<span class="c1">#self.kde_shapes_fn= &#39;elg-shapes-kde.pickle&#39;</span>
		<span class="c1">#self.kde_colors_shapes_fn= &#39;elg-colors-shapes-kde.pickle&#39;</span>
		<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kdefn&#39;</span><span class="p">]:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span> <span class="p">)</span>

<div class="viewcode-block" id="ELG.get_dr3_deep2"><a class="viewcode-back" href="../../index.html#obiwan.priors.ELG.get_dr3_deep2">[docs]</a>	<span class="k">def</span> <span class="nf">get_dr3_deep2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;version 3.0 of data discussed in</span>
<span class="sd">		https://desi.lbl.gov/DocDB/cgi-bin/private/RetrieveFile?docid=912&quot;&quot;&quot;</span>
		<span class="c1"># Cut on DR3 rmag &lt; self.rlimit</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">zcat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;../deep2/v3.0/&#39;</span><span class="p">,</span><span class="s1">&#39;deep2-field1-oii.fits.gz&#39;</span><span class="p">))</span>
			<span class="n">R_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_r&#39;</span><span class="p">)</span>
			<span class="n">rmag_cut</span><span class="o">=</span> <span class="n">R_MAG</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">rlimit</span> 
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">zcat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;deep2f234-dr3matched.fits&#39;</span><span class="p">))</span>
			<span class="n">decals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;dr3-deep2f234matched.fits&#39;</span><span class="p">))</span>
			<span class="c1"># Add mag data </span>
			<span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
			<span class="n">rflux</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">rmag_cut</span><span class="o">=</span> <span class="n">rflux</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rlimit</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span>
			<span class="n">rmag_cut</span><span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
		<span class="n">zcat</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">rmag_cut</span><span class="p">)</span> 
		<span class="n">decals</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">rmag_cut</span><span class="p">)</span> 
		<span class="c1"># color data</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">G_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_g&#39;</span><span class="p">)</span>
			<span class="n">R_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_r&#39;</span><span class="p">)</span>
			<span class="n">Z_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_z&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">G_MAG</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">R_MAG</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">Z_MAG</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
			<span class="n">R_MAG_nodust</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
			<span class="c1"># Don&#39;t need w1, but might be useful</span>
			<span class="n">W1_MAG</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
		<span class="c1"># Repackage</span>
		<span class="n">tab</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">()</span>
		<span class="c1"># Deep2</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">ra</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">zhelio</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;oii_3727&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">oii_3727</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;oii_3727_err&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">oii_3727_err</span><span class="p">)</span>
		<span class="c1"># Decals</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">,</span> <span class="n">G_MAG</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">,</span> <span class="n">R_MAG</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">,</span> <span class="n">Z_MAG</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;w1_wdust&#39;</span><span class="p">,</span> <span class="n">W1_MAG</span><span class="p">)</span> 
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_nodust&#39;</span><span class="p">,</span> <span class="n">R_MAG_nodust</span><span class="p">)</span>
		<span class="c1"># DR3 shape info</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]:</span>
			<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">tab</span></div>


	<span class="k">def</span> <span class="nf">get_FDR_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
		<span class="n">oiicut1</span> <span class="o">=</span> <span class="mf">8E-17</span> <span class="c1"># [erg/s/cm2]</span>
		<span class="n">zmin</span> <span class="o">=</span> <span class="mf">0.6</span>
		<span class="n">keep</span><span class="o">=</span> <span class="p">{}</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;lowz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;</span> <span class="n">zmin</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;</span> <span class="n">zmin</span><span class="p">,</span>\
								 <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span>\
								 <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&lt;</span> <span class="n">oiicut1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;</span> <span class="n">zmin</span><span class="p">,</span>\
								<span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span>\
								<span class="n">tab</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span>\
								<span class="n">tab</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&gt;</span> <span class="n">oiicut1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">,</span>\
								   <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">!=-</span><span class="mf">2.0</span><span class="p">,</span>\
							   <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&gt;</span> <span class="n">oiicut1</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span> 

	<span class="k">def</span> <span class="nf">get_obiwan_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> \
			   <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;=</span> <span class="mf">1.4</span><span class="p">)</span> <span class="o">*</span> \
			   <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">*</span> \
			   <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">fit_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_acs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="c1"># Load Data</span>
		<span class="k">if</span> <span class="n">use_acs</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Matching acs to dr3,deep2&#39;</span><span class="p">)</span>
			<span class="n">deep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
			<span class="n">acs</span><span class="o">=</span> <span class="n">get_acs_six_col</span><span class="p">()</span>
			<span class="n">imatch</span><span class="p">,</span><span class="n">imiss</span><span class="p">,</span><span class="n">d2d</span><span class="o">=</span> <span class="n">Matcher</span><span class="p">()</span><span class="o">.</span><span class="n">match_within</span><span class="p">(</span><span class="n">deep</span><span class="p">,</span><span class="n">acs</span><span class="p">,</span><span class="n">dist</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span>
			<span class="n">deep</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">imatch</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">])</span>
			<span class="n">acs</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">imatch</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">])</span>
			<span class="c1"># Remove ra,dec from acs, then merge</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">]:</span>
				<span class="n">acs</span><span class="o">.</span><span class="n">delete_column</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="n">tab</span><span class="o">=</span> <span class="n">merge_tables</span><span class="p">([</span><span class="n">deep</span><span class="p">,</span><span class="n">acs</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_deep2 </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span>
		<span class="c1"># Add tractor shapes</span>
		<span class="n">dic</span><span class="o">=</span> <span class="n">get_tractor_shapes</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">])</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_n&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
		<span class="c1"># Cuts</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_deep2, after obiwan cut </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span>
		<span class="c1"># Cut bad values</span>
		<span class="n">keep</span><span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span><span class="nb">bool</span><span class="p">)</span> <span class="p">)</span>
		<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">keep</span> <span class="o">*=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)))</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_deep2, after cut bad vals </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span>
		<span class="c1"># Sanity plots</span>
		<span class="n">plot_tractor_shapes</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;ELG_dr3deep2_expdev&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;size </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">])))</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="p">)</span>
		<span class="n">xy_names</span><span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;zhelio&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">)]</span>
		<span class="c1">#xy_lims= [(&#39;tractor_re&#39;,&#39;zhelio&#39;),</span>
		<span class="c1">#           (&#39;tractor_re&#39;,&#39;r_wdust&#39;),</span>
		<span class="c1">#           (&#39;tractor_re&#39;,&#39;g_wdust&#39;),</span>
		<span class="c1">#           (&#39;tractor_re&#39;,&#39;z_wdust&#39;)]</span>
		<span class="n">plot_indiv_2d</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">xy_names</span><span class="o">=</span><span class="n">xy_names</span><span class="p">,</span><span class="n">xy_lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;ELG_dr3deep2&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
		<span class="c1"># KDE</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">,</span><span class="s1">&#39;rz&#39;</span><span class="p">,</span><span class="s1">&#39;gr&#39;</span><span class="p">,</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">]</span>
				<span class="c1">#&#39;re&#39;,&#39;n&#39;,&#39;ba&#39;,&#39;pa&#39;]</span>
		<span class="n">lims</span><span class="o">=</span> <span class="p">[(</span><span class="mf">20.5</span><span class="p">,</span><span class="mf">25.</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)]</span>
			  <span class="c1"># (0.,100.),(0.,10.),(0.2,0.9),(0.,180.)]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">,</span>
								<span class="n">tab</span><span class="o">.</span><span class="n">g_wdust</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span><span class="p">,</span>
								<span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span><span class="p">],</span>
							   <span class="n">labels</span><span class="p">,</span><span class="n">lims</span><span class="p">,</span>\
							   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
							   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xy_names</span><span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;rz&#39;</span><span class="p">,</span><span class="s1">&#39;gr&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;gr&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;rz&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;gr&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;rz&#39;</span><span class="p">)]</span>
		<span class="n">xy_lims</span><span class="o">=</span> <span class="p">[([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]),</span>
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mf">20.5</span><span class="p">,</span><span class="mf">25.</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="mf">20.5</span><span class="p">,</span><span class="mi">25</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span>  
				 <span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_indiv_2d</span><span class="p">(</span><span class="n">xy_names</span><span class="p">,</span><span class="n">xy_lims</span><span class="o">=</span><span class="n">xy_lims</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;ELG_dr3deep2&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_FDR_using_kde</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">,</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;dr3deep2&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
	<span class="c1">#        xylims=dict(x1=(20.5,25.5),y1=(0,0.8),\</span>
	<span class="c1">#                    x2=xyrange[&#39;x_elg&#39;],y2=xyrange[&#39;y_elg&#39;],\</span>
	<span class="c1">#                    x3=(0.6,1.6),y3=(0.,1.0),</span>
	<span class="c1">#                    x4=(0,100),\</span>
	<span class="c1">#                    x5=(0,10),\</span>
	<span class="c1">#                    x6=(0,1),\</span>
	<span class="c1">#                    x7=(0,180))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;elg_&#39;)</span>
		<span class="c1">#kde_obj.plot_colors_shapes_z(ndraws=1000,xylims=xylims,name=&#39;elg_colors_shapes_z_kde.png&#39;)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="c1">#if os.path.exists(self.kde_colors_shapes_fn):</span>
			<span class="c1">#    os.remove(self.kde_colors_shapes_fn)</span>
			<span class="c1">#kde_obj.save(name=self.kde_colors_shapes_fn)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>


	<span class="k">def</span> <span class="nf">cross_validate_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">r_nodust</span><span class="p">,</span><span class="n">r_wdust</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">key</span><span class="o">=</span><span class="s1">&#39;goodz_oiibright&#39;</span>
		<span class="n">categors</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
		<span class="n">zbins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">lft</span><span class="p">,</span><span class="n">rt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">zbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">zbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
			<span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">][</span> <span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lft</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rt</span><span class="p">)</span> <span class="p">]</span><span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
		<span class="n">X</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
		<span class="n">obj</span><span class="o">=</span> <span class="n">RedshiftPredictor</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>\
							   <span class="n">y</span><span class="o">=</span><span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
		<span class="n">obj</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
		 

	<span class="k">def</span> <span class="nf">plot_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">r_nodust</span><span class="p">,</span><span class="n">r_wdust</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
		<span class="c1"># Plot data</span>
		<span class="n">zbins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
		<span class="n">mysvm</span><span class="p">,</span><span class="n">mynn</span><span class="p">,</span><span class="n">categors</span><span class="o">=</span><span class="p">{},{},{}</span>
		<span class="c1"># Plot, Predict, Predict</span>
		<span class="c1"># Discrete Color Map</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
		<span class="n">bounds</span> <span class="o">=</span> <span class="n">zbins</span>
		<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
		<span class="c1"># Make plots</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
							  <span class="p">[</span><span class="s1">&#39;goodz_oiibright&#39;</span><span class="p">,</span><span class="s1">&#39;goodz_oiifaint&#39;</span><span class="p">],</span>\
							  <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z=(0.8,1.4) [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z=(0.8,1.4) [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">]):</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Learning redshifts for sample=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="c1"># Scatter</span>
			<span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>\
									 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
									 <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
			<span class="n">title</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
			<span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">])</span>
			<span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
			<span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
								 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
			<span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
			<span class="c1">#cbar = fig.colorbar(axobj, orientation=&#39;vertical&#39;)</span>
			<span class="c1"># Train &amp; Predict</span>
			<span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">ithbin</span><span class="p">,</span><span class="n">lft</span><span class="p">,</span><span class="n">rt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zbins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">zbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">zbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
				<span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">][</span> <span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lft</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rt</span><span class="p">)</span> <span class="p">]</span><span class="o">=</span> <span class="n">ithbin</span><span class="o">+</span><span class="mi">1</span>
			<span class="n">X</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
			<span class="n">mysvm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">RedshiftPredictor</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
			<span class="n">mysvm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">svm</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
			<span class="c1"># FIX!!!! ADD 5 color color bar, len(zbins)-1, </span>
			<span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">mysvm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>\
									 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>\
									 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
									 <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
			<span class="c1">#cbar = fig.colorbar(axobj, orientation=&#39;vertical&#39;)</span>
			<span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">])</span>
			<span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
			<span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
								 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
			<span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
			<span class="c1"># FIX add lines dividing the two samples, see sklearn doc plot examples</span>
			<span class="c1"># Train &amp; Predict</span>
			<span class="n">mynn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">RedshiftPredictor</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
			<span class="n">mynn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">nn</span><span class="p">(</span><span class="n">nn</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
			<span class="c1"># FIX!!!! ADD 5 color color bar, len(zbins)-1, </span>
			<span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">mynn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>\
									 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>\
									 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
									 <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
			<span class="c1">#cbar = fig.colorbar(axobj, orientation=&#39;vertical&#39;)</span>
			<span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">cnt</span><span class="p">])</span>
			<span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
			<span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
								 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
			<span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
		<span class="c1"># Finish axes</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
				<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="c1"># Save</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_redshifts.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">cbar3</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">])</span> <span class="c1">#, bbox_inches=&#39;tight&#39;,dpi=150)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="c1"># Cuts &#39;lowz&#39;,&#39;medz_lowO2&#39; ...</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
		<span class="c1"># Add box</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
		<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
		<span class="c1"># Add points</span>
		<span class="k">for</span> <span class="n">cut_name</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">marker</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;lowz&#39;</span><span class="p">,</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">,</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">,</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">],</span>
						<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span>
						 <span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">],</span>
											 <span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>
											 <span class="p">[</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]):</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span> 
					   <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
		<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
		<span class="n">leg</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
				  <span class="n">markerscale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_ELG.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="c1"># Cuts &#39;lowz&#39;,&#39;medz_lowO2&#39; ...</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">marker</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						<span class="p">[</span><span class="s1">&#39;lowz&#39;</span><span class="p">,</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">,</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">,</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">],</span>
						<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span>
							<span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">],</span>
						<span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>
						<span class="p">[</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]):</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="c1"># Add points</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
			<span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_FDR_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_obiwan_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="c1"># Cuts &#39;lowz&#39;,&#39;medz_lowO2&#39; ...</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
							<span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
							<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$0.8&lt;z&lt;1.4, [OII] &gt; 0$&#39;</span><span class="p">,</span><span class="s1">&#39;Everything else&#39;</span><span class="p">],</span>
							<span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]):</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="c1"># Add points</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
			<span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_obiwan_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">plot_LRG_FDR_wELG_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">dic</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>\
							   <span class="p">[</span><span class="s1">&#39;loz&#39;</span><span class="p">,</span><span class="s1">&#39;oiifaint&#39;</span><span class="p">,</span><span class="s1">&#39;oiibright_loz&#39;</span><span class="p">,</span><span class="s1">&#39;oiibright_hiz&#39;</span><span class="p">],</span>\
							   <span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>\
							   <span class="p">[</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>\
							   <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">]):</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="c1"># Add points</span>
			<span class="n">b</span><span class="o">=</span> <span class="n">key</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;rz&#39;</span><span class="p">][</span><span class="n">b</span><span class="p">],</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;rw1&#39;</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
			<span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
			<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_FDR_wELG_data.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						<span class="p">[</span><span class="s1">&#39;lowz&#39;</span><span class="p">,</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">,</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">,</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">],</span>
						<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span>
							<span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">]):</span>
			<span class="c1"># Mag data</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span> <span class="o">+</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mag&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
			<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_mag_dist_FDR.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_obiwan_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						<span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
						<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$0.8&lt;z&lt;1.4, [OII] &gt; 0$&#39;</span><span class="p">,</span><span class="s1">&#39;Everything else&#39;</span><span class="p">]):</span>
			<span class="c1"># Mag data</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">thecut</span><span class="p">]</span> <span class="o">+</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">]</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">thecut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mag&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
			<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_mag_dist_obiwan.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR_multipanel</span><span class="p">()</span>
		<span class="c1">#plot_FDR(self.Xall,self.cuts,src=&#39;ELG&#39;)</span>
		<span class="c1">#b= self.cuts[&#39;any_elg&#39;]</span>
		<span class="c1">#color_color_plot(self.Xall[b,:],src=&#39;ELG&#39;,append=&#39;_FDR&#39;) #,extra=True)</span>
		<span class="c1">#Xall,cuts, morph= elg_data()</span>
		<span class="c1">#color_color_plot(Xall, src=&#39;ELG&#39;,append=&#39;_synth&#39;) #,extra=True)</span>
		<span class="c1">#b= cuts[&#39;has_morph&#39;]</span>
		<span class="c1">#color_color_plot(Xall[b,:],src=&#39;ELG&#39;,append=&#39;_synth+morph&#39;) #,extra=True)</span>

	<span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">r_nodust</span><span class="p">,</span><span class="n">r_wdust</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">x</span><span class="o">=</span> <span class="n">r_wdust</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">y</span><span class="o">=</span> <span class="n">rz</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">z</span><span class="o">=</span> <span class="n">gr</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">d4</span><span class="o">=</span> <span class="n">redshift</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">cut</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">d4</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r wdust&#39;</span><span class="p">,</span><span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;g-r&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
							   <span class="p">[(</span><span class="mf">20.5</span><span class="p">,</span><span class="mf">25.</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">)],</span>\
							   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
							   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mf">25.5</span><span class="p">),</span><span class="n">y1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">y2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">],</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),</span><span class="n">y3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;elg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_1band_color_and_redshift</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;elg_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">plot_kde_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_matched_deep2</span><span class="p">()</span>
		<span class="n">pa</span><span class="o">+=</span> <span class="mf">90.</span> <span class="c1"># 0-180 deg</span>
		<span class="c1">#cut= (np.isfinite(x))* (np.isfinite(y))* (np.isfinite(z))</span>
		<span class="c1">#x,y,z,d4= x[cut],y[cut],z[cut],d4[cut]</span>
		<span class="c1"># ba &gt; 0</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
							   <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">10.</span><span class="p">),(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">180.</span><span class="p">)],</span>\
							   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
							   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>\
					<span class="n">x4</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;elg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_galaxy_shapes</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;elg_shapes_kde.png&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span></div>

<span class="c1"># Returns re,n measured by tractor given a Tractor Cataluge</span>
<span class="k">def</span> <span class="nf">get_tractor_shapes</span><span class="p">(</span><span class="n">cat</span><span class="p">):</span>
    <span class="n">d</span><span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">]:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cat</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
    <span class="c1"># Re,N</span>
    <span class="c1"># SIMP</span>
    <span class="c1">#keep= (cat.type == &#39;SIMP&#39;) * (cat.shapeexp_r &gt; 0.)</span>
    <span class="c1">#d[&#39;re&#39;][keep]= cat.shapeexp_r[keep]</span>
    <span class="c1">#d[&#39;n&#39;][keep]= 1.</span>
    <span class="c1"># EXP</span>
    <span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">shapeexp_r</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">shapeexp_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="mf">1.</span>
    <span class="c1"># DEV</span>
    <span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">shapedev_r</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">shapedev_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="mf">4.</span>
    <span class="c1"># BA, PA</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ba&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cat</span><span class="p">))</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pa&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">180.</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cat</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">plot_tractor_shapes</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">rng</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;tractor_n&#39;</span><span class="p">],</span>
                        <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)]):</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">keep</span><span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.</span>
        <span class="c1">#h,edges= np.histogram(cat.get(name)[keep],bins=40,normed=True)</span>
        <span class="c1">#binc= (edges[1:]+edges[:-1])/2.</span>
        <span class="c1">#ax.step(binc,h,where=&#39;mid&#39;,lw=1,c=&#39;b&#39;)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
        <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;tractor_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outdir</span><span class="p">:</span>
            <span class="n">savenm</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">savenm</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nb</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_tractor_galfit_shapes</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">keep</span><span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="n">keep</span><span class="p">],</span> <span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)[</span><span class="n">keep</span><span class="p">],</span>
                   <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;galfit_hi_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;tractor_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;tractor_galfit_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
 
<span class="c1"># 2D plots</span>
<span class="k">def</span> <span class="nf">plot_indiv_2d</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">xy_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xy_lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">xy_names</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xy_names</span><span class="p">):</span>
        <span class="n">xname</span><span class="o">=</span> <span class="n">xy_names</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yname</span><span class="o">=</span> <span class="n">xy_names</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Plot</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xname</span><span class="p">),</span><span class="n">tab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yname</span><span class="p">),</span>
                   <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xname</span><span class="p">)</span>
        <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xy_lims</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xy_lims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xy_lims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;plot_2d_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">xname</span><span class="p">,</span><span class="n">yname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outdir</span><span class="p">:</span>
            <span class="n">savenm</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">savenm</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nb</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<div class="viewcode-block" id="LRG"><a class="viewcode-back" href="../../index.html#obiwan.priors.LRG">[docs]</a><span class="k">class</span> <span class="nc">LRG</span><span class="p">(</span><span class="n">CommonInit</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Creates the LRG sample</span>

<span class="sd">	Args: </span>
<span class="sd">		see CommonInit</span>

<span class="sd">	Attributes:</span>
<span class="sd">		zlimit: AB magnitude limit of sample</span>
<span class="sd">		kdefn: name for the fit KDE</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">LRG</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">zlimit</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zlimit&#39;</span><span class="p">,</span><span class="mf">20.46</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LRGs, self.zlimit= &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zlimit</span><span class="p">)</span>
		<span class="c1"># KDE params</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="o">=</span> <span class="s1">&#39;lrg-kde.pickle&#39;</span>
		<span class="c1">#self.kde_shapes_fn= &#39;lrg-shapes-kde.pickle&#39;</span>
		<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kdefn&#39;</span><span class="p">]:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span> <span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_dr3_cosmos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Cosmos</span>
		<span class="c1"># http://irsa.ipac.caltech.edu/data/COSMOS/gator_docs/cosmos_zphot_mag25_colDescriptions.html</span>
		<span class="c1"># http://irsa.ipac.caltech.edu/data/COSMOS/tables/redshift/cosmos_zphot_mag25.README</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">decals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;decals-dr2-cosmos-zphot.fits.gz&#39;</span><span class="p">)</span> <span class="p">)</span>
			<span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;cosmos-zphot.fits.gz&#39;</span><span class="p">)</span> <span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">decals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;dr3-cosmoszphotmatched.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
			<span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;cosmos-zphot-dr3matched.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
		<span class="c1"># DECaLS</span>
		<span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
		<span class="n">Z_FLUX</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
		<span class="n">W1_FLUX</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
		<span class="c1"># Cuts</span>
		<span class="c1"># BUG!!</span>
		<span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">Z_FLUX</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">zlimit</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">),</span>\
					  <span class="n">W1_FLUX</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">keep</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
		<span class="n">decals</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span> 
		<span class="n">spec</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
		<span class="c1"># Repackage</span>
		<span class="n">tab</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">()</span>
		<span class="c1"># Cosmos</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">ra</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">zp_gal</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;type_zphotcomos&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mod_gal&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">mod_gal</span><span class="p">)</span>
		<span class="c1"># DR3</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">])</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;w1_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_nodust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z_nodust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">])</span>
		<span class="c1"># DR3 shape info</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]:</span>
			<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">tab</span>
								 

	<span class="k">def</span> <span class="nf">get_FDR_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
		<span class="n">keep</span><span class="o">=</span><span class="p">{}</span>  
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span>\
							 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span>\
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">zp_gal</span> <span class="o">&lt;=</span> <span class="mf">0.6</span><span class="p">)</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span>\
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">zp_gal</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>

	<span class="k">def</span> <span class="nf">get_obiwan_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
		<span class="c1"># No redshift limits, just reddish galaxy</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">type_zphotcomos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
			   <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> 
		<span class="k">return</span> <span class="n">keep</span>

<div class="viewcode-block" id="LRG.fit_kde"><a class="viewcode-back" href="../../index.html#obiwan.priors.LRG.fit_kde">[docs]</a>	<span class="k">def</span> <span class="nf">fit_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">use_acs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
				<span class="n">loadkde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">savekde</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;No Targeting cuts on g band, but need to fit it so can insert in grz image&quot;&quot;&quot;</span>
		<span class="c1"># Load Data</span>
		<span class="k">if</span> <span class="n">use_acs</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Matching acs to dr3,cosmos&#39;</span><span class="p">)</span>
			<span class="n">cosmos</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
			<span class="n">acs</span><span class="o">=</span> <span class="n">get_acs_six_col</span><span class="p">()</span>
			<span class="n">imatch</span><span class="p">,</span><span class="n">imiss</span><span class="p">,</span><span class="n">d2d</span><span class="o">=</span> <span class="n">Matcher</span><span class="p">()</span><span class="o">.</span><span class="n">match_within</span><span class="p">(</span><span class="n">cosmos</span><span class="p">,</span><span class="n">acs</span><span class="p">,</span><span class="n">dist</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span>
			<span class="n">cosmos</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">imatch</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">])</span>
			<span class="n">acs</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">imatch</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">])</span>
			<span class="c1"># Remove ra,dec from acs, then merge</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">]:</span>
				<span class="n">acs</span><span class="o">.</span><span class="n">delete_column</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="n">tab</span><span class="o">=</span> <span class="n">merge_tables</span><span class="p">([</span><span class="n">cosmos</span><span class="p">,</span><span class="n">acs</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_cosmos </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span>
		<span class="c1"># Add tractor shapes</span>
		<span class="n">dic</span><span class="o">=</span> <span class="n">get_tractor_shapes</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># WARNING: not actually using &#39;pa, ba, n&#39; for KDE </span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">])</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_n&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
		<span class="c1"># Cuts</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_cosmos after obiwan cuts: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span>
		<span class="c1"># 9D space</span>
		<span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span><span class="nb">bool</span><span class="p">)</span> 
		<span class="c1">#use_cols= [&#39;g_wdust&#39;,&#39;r_wdust&#39;,&#39;z_wdust&#39;,&#39;w1_wdust&#39;,</span>
		<span class="c1">#           &#39;zp_gal&#39;]</span>
		<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">keep</span> <span class="o">*=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span> <span class="n">tab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">))</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_cosmos after finite cuts: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span>
		<span class="c1"># Redshift &gt; bandwidth</span>
		<span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">zp_gal</span> <span class="o">-</span> <span class="n">bandwidth</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_cosmos after redshift &gt; </span><span class="si">%f</span><span class="s1">: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bandwidth</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">)))</span>
		<span class="c1"># Sanity plot</span>
		<span class="n">plot_tractor_shapes</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;LRG_dr3cosmos_expdev&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;size </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">])))</span>
		<span class="c1">#plot_tractor_galfit_shapes(tab,prefix=&#39;LRG_dr3cosmosacs&#39;)</span>
		<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
		<span class="n">xy_names</span><span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">)]</span>
		<span class="n">plot_indiv_2d</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">xy_names</span><span class="o">=</span><span class="n">xy_names</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
		<span class="c1"># KDE</span>
		<span class="n">names</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">,</span><span class="s1">&#39;rz&#39;</span><span class="p">,</span><span class="s1">&#39;rw1&#39;</span><span class="p">,</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">,</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">]</span>
				<span class="c1">#&#39;re&#39;,&#39;n&#39;,&#39;ba&#39;,&#39;pa&#39;]</span>
		<span class="n">fitlims</span><span class="o">=</span> <span class="p">[(</span><span class="mf">17.</span><span class="p">,</span><span class="mf">22.</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">),(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">5.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),(</span><span class="mf">17.</span><span class="p">,</span><span class="mi">29</span><span class="p">),(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)]</span> <span class="c1">#,(0.,10.),(0.2,0.9),(0.,180.)]</span>
		<span class="c1">#tab.n, tab.ba, tab.pa</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">,</span> 
								<span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">w1_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">zp_gal</span><span class="p">,</span> 
								<span class="n">tab</span><span class="o">.</span><span class="n">g_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span><span class="p">],</span>
								<span class="n">names</span><span class="p">,</span><span class="n">fitlims</span><span class="p">,</span>\
						   <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
						   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="c1">#kde_obj.plot_indiv_1d(lims=plotlims, ndraws=1000,prefix=&#39;lrg_dr3cosmosacs&#39;)</span>
		<span class="n">xy_names</span><span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;rz&#39;</span><span class="p">,</span><span class="s1">&#39;rw1&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span><span class="s1">&#39;rz&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span><span class="s1">&#39;rw1&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;rz&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">),</span>
				   <span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span><span class="s1">&#39;rw1&#39;</span><span class="p">)]</span>
		<span class="n">xy_lims</span><span class="o">=</span> <span class="p">[([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">5.</span><span class="p">]),</span>
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="mi">17</span><span class="p">,</span><span class="mi">29</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="mi">17</span><span class="p">,</span><span class="mi">22</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">5.</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">],[</span><span class="mi">17</span><span class="p">,</span><span class="mi">29</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">],[</span><span class="mi">17</span><span class="p">,</span><span class="mi">22</span><span class="p">]),</span>  
				  <span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span> 
				 <span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_indiv_2d</span><span class="p">(</span><span class="n">xy_names</span><span class="p">,</span><span class="n">xy_lims</span><span class="o">=</span><span class="n">xy_lims</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;lrg_dr3cosmosacs&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_FDR_using_kde</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">,</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;dr3cosmos&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
		<span class="c1">#plotlims= [(17.,22.),(0,2.5),(-2,5.),(0.,1.6),(17.,29),(-0.5,2.)] #,(-2,10.),(-0.2,1.2),(-20,200)]</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;lrg_&#39;)</span>
		<span class="c1">#kde_obj.plot_1band_color_and_redshift(ndraws=1000,xylims=xylims,prefix=&#39;lrg_&#39;)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">plot_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="c1"># Add box</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
		<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
		<span class="c1"># Data</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						<span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">rW1</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
					   <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">cut_name</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="n">leg</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>\
					  <span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_LRG.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>   
					   <span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">rW1</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
							<span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cut_name</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
			<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_FDR_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_obiwan_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>   
								  <span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
								  <span class="p">[</span><span class="s1">&#39;red galaxy&#39;</span><span class="p">,</span><span class="s1">&#39;everything else&#39;</span><span class="p">],</span>
								  <span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">rW1</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
							<span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cut_name</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
			<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_obiwan_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">plot_LRGs_in_ELG_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">data</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lrgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="n">keys</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">keys</span><span class="p">,</span><span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rz&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
							<span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRGs_in_ELG_FDR.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
					<span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="c1"># Mag data</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">g_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cut_name</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mags&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_mag_dist_FDR.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_obiwan_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
					<span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
					<span class="p">[</span><span class="s1">&#39;red galaxy&#39;</span><span class="p">,</span><span class="s1">&#39;everything else&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="c1"># Mag data</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">g_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mags&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_mag_dist_obiwan.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


<div class="viewcode-block" id="LRG.get_vipers"><a class="viewcode-back" href="../../index.html#obiwan.priors.LRG.get_vipers">[docs]</a>	<span class="k">def</span> <span class="nf">get_vipers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;LRGs from VIPERS in CFHTLS W4 field (12 deg2)&quot;&quot;&quot;</span>
		<span class="c1"># DR2 matched</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">decals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;decals-dr2-vipers-w4.fits.gz&#39;</span><span class="p">))</span>
			<span class="n">vip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;vipers-w4.fits.gz&#39;</span><span class="p">))</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">decals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;dr3-vipersw1w4matched.fits&#39;</span><span class="p">))</span>
			<span class="n">vip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;vipersw1w4-dr3matched.fits&#39;</span><span class="p">))</span>
		<span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
		<span class="n">Z_FLUX</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
		<span class="n">W1_FLUX</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">index</span><span class="o">=</span><span class="p">{}</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;decals&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">Z_FLUX</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">zlimit</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">),</span>\
								 <span class="n">W1_FLUX</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;decals&#39;</span><span class="p">]</span><span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
		<span class="c1"># VIPERS</span>
		<span class="c1"># https://arxiv.org/abs/1310.1008</span>
		<span class="c1"># https://arxiv.org/abs/1303.2623</span>
		<span class="n">flag</span><span class="o">=</span> <span class="n">vip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zflg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;good_z&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">flag</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span>\
								 <span class="n">flag</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">,</span>\
								 <span class="n">vip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zspec&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">9.9</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
		<span class="c1"># return Mags</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">rW1</span><span class="o">=</span><span class="p">{},{}</span>
		<span class="n">cut</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">index</span><span class="p">[</span><span class="s1">&#39;decals&#39;</span><span class="p">],</span>\
					 <span class="n">index</span><span class="p">[</span><span class="s1">&#39;good_z&#39;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rz</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">cut</span><span class="p">]</span> <span class="o">-</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">cut</span><span class="p">]</span>
		<span class="n">rW1</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">cut</span><span class="p">]</span> <span class="o">-</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">cut</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">rz</span><span class="p">,</span><span class="n">rW1</span></div>




	<span class="k">def</span> <span class="nf">plot_vipers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">rW1</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vipers</span><span class="p">()</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">rW1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">])</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="c1"># Add box</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
		<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_vipers.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR_multipanel</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_vipers</span><span class="p">()</span>
		<span class="c1">#plot_FDR(self.Xall,self.cuts,src=&#39;LRG&#39;)</span>
		<span class="c1">#color_color_plot(self.Xall,src=&#39;LRG&#39;,append=&#39;cc&#39;) #,extra=True)</span>
		<span class="c1">#b= self.cuts[&#39;lrg&#39;)</span>
		<span class="c1">#color_color_plot(self.Xall[b,:],src=&#39;LRG&#39;) #,extra=True)</span>

<div class="viewcode-block" id="LRG.plot_kde"><a class="viewcode-back" href="../../index.html#obiwan.priors.LRG.plot_kde">[docs]</a>	<span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">savekde</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;No Targeting cuts on g band, but need to fit it so can insert in grz image&quot;&quot;&quot;</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">rW1</span><span class="p">,</span><span class="n">r_nodust</span><span class="p">,</span><span class="n">r_wdust</span><span class="p">,</span><span class="n">z_nodust</span><span class="p">,</span><span class="n">z_wdust</span><span class="p">,</span><span class="n">g_wdust</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lrgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">x</span><span class="o">=</span> <span class="n">z_wdust</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">y</span><span class="o">=</span> <span class="n">rz</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">z</span><span class="o">=</span> <span class="n">rW1</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">d4</span><span class="o">=</span> <span class="n">redshift</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">M</span><span class="o">=</span> <span class="n">g_wdust</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">cut</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">z</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
		<span class="c1"># Redshift &gt; 0 given bandwidth</span>
		<span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span>
		<span class="n">cut</span><span class="o">*=</span> <span class="p">(</span><span class="n">d4</span> <span class="o">-</span> <span class="n">bandwidth</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="p">,</span><span class="n">M</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">d4</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z wdust&#39;</span><span class="p">,</span><span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;r-W1&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;g wdust&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="p">,</span><span class="n">M</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
						   <span class="p">[(</span><span class="mf">17.</span><span class="p">,</span><span class="mf">22.</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">),(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">5.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),(</span><span class="mf">17.</span><span class="p">,</span><span class="mi">29</span><span class="p">)],</span>\
						   <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
						   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mf">17.</span><span class="p">,</span><span class="mf">22.</span><span class="p">),</span><span class="n">y1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">y2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">],</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),</span><span class="n">y3</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span>\
					<span class="n">x4</span><span class="o">=</span><span class="p">(</span><span class="mf">17.</span><span class="p">,</span><span class="mi">29</span><span class="p">),</span><span class="n">y4</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.7</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;lrg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_1band_color_and_redshift</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;lrg_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span></div>


	<span class="k">def</span> <span class="nf">plot_kde_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_matched_cosmoszphot</span><span class="p">()</span>
		<span class="n">pa</span><span class="o">+=</span> <span class="mf">90.</span> <span class="c1"># 0-180 deg</span>
		<span class="c1">#cut= (np.isfinite(x))* (np.isfinite(y))* (np.isfinite(z))</span>
		<span class="c1">#x,y,z,d4= x[cut],y[cut],z[cut],d4[cut]</span>
		<span class="c1"># ba &gt; 0</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
							   <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">10.</span><span class="p">),(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">180.</span><span class="p">)],</span>\
							   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
							   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">),</span>\
					<span class="n">x4</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;elg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_galaxy_shapes</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lrg_shapes_kde.png&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span></div>


<div class="viewcode-block" id="STAR"><a class="viewcode-back" href="../../index.html#obiwan.priors.STAR">[docs]</a><span class="k">class</span> <span class="nc">STAR</span><span class="p">(</span><span class="n">CommonInit</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Creates the STAR sample</span>

<span class="sd">	Args: </span>
<span class="sd">		see CommonInit</span>

<span class="sd">	Attributes:</span>
<span class="sd">		kdefn: name for the fit KDE</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">STAR</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="c1"># KDE params</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="o">=</span> <span class="s1">&#39;star-kde.pickle&#39;</span>
		<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kdefn&#39;</span><span class="p">]:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span> <span class="p">)</span>

<div class="viewcode-block" id="STAR.get_sweepstars"><a class="viewcode-back" href="../../index.html#obiwan.priors.STAR.get_sweepstars">[docs]</a>	<span class="k">def</span> <span class="nf">get_sweepstars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Model the g-r, r-z color-color sequence for stars&quot;&quot;&quot;</span>
		<span class="c1"># Build a sample of stars with good photometry from a single sweep.</span>
		<span class="n">rbright</span> <span class="o">=</span> <span class="mi">18</span>
		<span class="n">rfaint</span> <span class="o">=</span> <span class="mf">19.5</span>
		<span class="n">swp_dir</span><span class="o">=</span><span class="s1">&#39;/global/project/projectdirs/cosmo/data/legacysurvey/dr2/sweep/2.0&#39;</span>
		<span class="n">sweep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">swp_dir</span><span class="p">,</span><span class="s1">&#39;sweep-340p000-350p005.fits&#39;</span><span class="p">))</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">sweep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;PSF &#39;</span><span class="p">)</span><span class="o">*</span>
						<span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">sweep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span>
						<span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">sweep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DECAM_ANYMASK&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span>
						<span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">sweep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DECAM_FRACFLUX&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span>
						<span class="p">(</span><span class="n">sweep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="mf">22.5</span><span class="o">-</span><span class="n">rbright</span><span class="p">))))</span><span class="o">*</span>
						<span class="p">(</span><span class="n">sweep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="mf">22.5</span><span class="o">-</span><span class="n">rfaint</span><span class="p">)))))[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">stars</span> <span class="o">=</span> <span class="n">sweep</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr2stars sample: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stars</span><span class="p">)))</span>
		<span class="n">gg</span> <span class="o">=</span> <span class="mf">22.5</span><span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
		<span class="n">rr</span> <span class="o">=</span> <span class="mf">22.5</span><span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">])</span>
		<span class="n">zz</span> <span class="o">=</span> <span class="mf">22.5</span><span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span> <span class="mi">4</span><span class="p">])</span>
		<span class="n">gr</span> <span class="o">=</span> <span class="n">gg</span> <span class="o">-</span> <span class="n">rr</span>
		<span class="n">rz</span> <span class="o">=</span> <span class="n">rr</span> <span class="o">-</span> <span class="n">zz</span>
		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rz</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">plot_sweepstars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
		<span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweepstars</span><span class="p">()</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">])</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.</span><span class="p">])</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;STAR_dr2.png&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
	  
	<span class="k">def</span> <span class="nf">get_purestars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># https://desi.lbl.gov/trac/wiki/TargetSelectionWG/TargetSelection#SpectrophotometricStandardStarsFSTD</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">stars</span><span class="o">=</span><span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;Stars_str82_355_4.DECaLS.dr2.fits&#39;</span><span class="p">))</span>
			<span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span>
			<span class="n">stars</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_star_cut</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span> <span class="p">)</span>
			<span class="k">return</span> <span class="n">stars</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_sweepstars</span><span class="p">()</span> 
		<span class="c1">#plt.plot(self.cat.get(&#39;ra&#39;),self.cat.get(&#39;dec&#39;))</span>
		<span class="c1">#plt.savefig(&#39;test.png&#39;)</span>
		<span class="c1">#plt.close()</span>

	<span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">savekde</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="n">stars</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_purestars</span><span class="p">()</span>
		<span class="n">x</span><span class="o">=</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">y</span><span class="o">=</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
		<span class="n">z</span><span class="o">=</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r wdust&#39;</span><span class="p">,</span><span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
						   <span class="p">[(</span><span class="mi">15</span><span class="p">,</span><span class="mi">24</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)],</span>\
						   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>\
						   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">24</span><span class="p">),</span><span class="n">y1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">3.5</span><span class="p">),</span><span class="n">y2</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_1band_and_color</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;star_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSO"><a class="viewcode-back" href="../../index.html#obiwan.priors.QSO">[docs]</a><span class="k">class</span> <span class="nc">QSO</span><span class="p">(</span><span class="n">CommonInit</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Creates the QSO sample</span>

<span class="sd">	Args: </span>
<span class="sd">		see CommonInit</span>

<span class="sd">	Attributes:</span>
<span class="sd">		rlimit: AB magnitude limit of sample</span>
<span class="sd">		kdefn: name for the fit KDE</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">QSO</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rlimit</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rlimit&#39;</span><span class="p">,</span><span class="mf">22.7</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;QSOs, self.rlimit= &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rlimit</span><span class="p">)</span>
		<span class="c1"># KDE params</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="o">=</span> <span class="s1">&#39;qso-kde.pickle&#39;</span>
		<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kdefn&#39;</span><span class="p">]:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span> <span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_qsos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>        
			<span class="n">qsos</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;AllQSO.DECaLS.dr2.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
			<span class="c1"># Add AB mags</span>
			<span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">qsos</span><span class="p">)</span>
			<span class="n">qsos</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">qsos</span><span class="p">)</span> <span class="p">)</span>
			<span class="c1"># r &lt; 22.7, grz &gt; 17</span>
			<span class="n">GFLUX</span> <span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span> 
			<span class="n">RFLUX</span> <span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">ZFLUX</span> <span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span> 
			<span class="n">GRZFLUX</span> <span class="o">=</span> <span class="p">(</span><span class="n">GFLUX</span> <span class="o">+</span> <span class="mf">0.8</span><span class="o">*</span> <span class="n">RFLUX</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span> <span class="n">ZFLUX</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">2.3</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">RFLUX</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rlimit</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">),</span>\
						 <span class="n">GRZFLUX</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="mf">17.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">qsos</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">cut</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">qsos</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not done yet&#39;</span><span class="p">)</span>
			<span class="n">qsos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;qso-dr3sweepmatched.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
			<span class="n">decals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truth_dir</span><span class="p">,</span><span class="s1">&#39;dr3-qsosweepmatched.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
			<span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
			<span class="n">decals</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">))</span>
			<span class="n">decals</span><span class="o">.</span><span class="n">cuts</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span> <span class="p">)</span>
			<span class="k">return</span> <span class="n">decals</span>
		<span class="c1">#G_FLUX= decals.get(&#39;decam_flux&#39;)[:,1]/decals.get(&#39;decam_mw_transmission&#39;)[:,1]</span>
		<span class="c1">#R_FLUX= decals.get(&#39;decam_flux&#39;)[:,2]/decals.get(&#39;decam_mw_transmission&#39;)[:,2]</span>
		<span class="c1">#Z_FLUX= decals.get(&#39;decam_flux&#39;)[:,4]/decals.get(&#39;decam_mw_transmission&#39;)[:,4]</span>
		<span class="c1"># DECaLS</span>
		<span class="c1">#index={}</span>
		<span class="c1">#rfaint=22.7</span>
		<span class="c1">#grzbright=17.</span>
		<span class="c1">#index[&#39;decals&#39;]= np.all((R_FLUX &gt; 10**((22.5-rfaint)/2.5),\</span>
		<span class="c1">#                         G_FLUX &lt; 10**((22.5-grzbright)/2.5),\</span>
		<span class="c1">#                         R_FLUX &lt; 10**((22.5-grzbright)/2.5),\</span>
		<span class="c1">#                         Z_FLUX &lt; 10**((22.5-grzbright)/2.5),\</span>
		<span class="c1">#                         decals.get(&#39;brick_primary&#39;) == True),axis=0)</span>
		<span class="c1"># QSO</span>
		<span class="c1"># Return</span>
	 
	<span class="k">def</span> <span class="nf">plot_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Data</span>
		<span class="n">qsos</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qsos</span><span class="p">()</span>
		<span class="n">star_obj</span><span class="o">=</span> <span class="n">STAR</span><span class="p">(</span><span class="n">DR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DR</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="n">stars</span><span class="o">=</span> <span class="n">star_obj</span><span class="o">.</span><span class="n">get_purestars</span><span class="p">()</span>
		<span class="n">hiz</span><span class="o">=</span><span class="mf">2.1</span>
		<span class="n">index</span><span class="o">=</span><span class="p">{}</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;hiz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">hiz</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;loz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">hiz</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="c1"># Stars</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">],</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">,</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="c1"># QSOs</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;loz&#39;</span><span class="p">,</span><span class="s1">&#39;hiz&#39;</span><span class="p">],[</span><span class="s1">&#39;(z &lt; 2.1)&#39;</span><span class="p">,</span><span class="s1">&#39;(z &gt; 2.1)&#39;</span><span class="p">],[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">]):</span>
			<span class="n">i</span><span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
			<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		
		<span class="c1">#for xlim,ylim,x_lab,y_lab in ax[0].set_xlim([-0.5,3.])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x1_qso&#39;</span><span class="p">])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x2_qso&#39;</span><span class="p">])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y1_qso&#39;</span><span class="p">])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y2_qso&#39;</span><span class="p">])</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W&#39;</span><span class="p">)</span>
		<span class="n">leg</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.02</span><span class="p">),</span><span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
		<span class="c1">## Add box</span>
		<span class="c1">#ts= TSBox(src=&#39;LRG&#39;)</span>
		<span class="c1">#xrange,yrange= xyrange[&#39;x_lrg&#39;],xyrange[&#39;y_lrg&#39;]</span>
		<span class="c1">#ts.add_ts_box(ax[cnt], xlim=xrange,ylim=yrange)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_QSO.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_multipanel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Data</span>
		<span class="n">qsos</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qsos</span><span class="p">()</span>
		<span class="n">star_obj</span><span class="o">=</span> <span class="n">STAR</span><span class="p">(</span><span class="n">DR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DR</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="n">stars</span><span class="o">=</span> <span class="n">star_obj</span><span class="o">.</span><span class="n">get_purestars</span><span class="p">()</span>
		<span class="n">hiz</span><span class="o">=</span><span class="mf">2.1</span>
		<span class="n">index</span><span class="o">=</span><span class="p">{}</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;hiz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">hiz</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;loz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">hiz</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="c1"># Stars top panel</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">],</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">,</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="c1"># QSOs loz middle, hiz bottom</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="s1">&#39;loz&#39;</span><span class="p">,</span><span class="s1">&#39;hiz&#39;</span><span class="p">],[</span><span class="s1">&#39;(z &lt; 2.1)&#39;</span><span class="p">,</span><span class="s1">&#39;(z &gt; 2.1)&#39;</span><span class="p">],[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">]):</span>
			<span class="n">i</span><span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
			<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
			<span class="c1">#for xlim,ylim,x_lab,y_lab in ax[0].set_xlim([-0.5,3.])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x1_qso&#39;</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x2_qso&#39;</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y1_qso&#39;</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y2_qso&#39;</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g-z&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W&#39;</span><span class="p">)</span>
		<span class="c1">#leg=ax[0,0].legend(loc=(0,1.02),scatterpoints=1,ncol=3,markerscale=2)</span>
		<span class="c1">## Add box</span>
		<span class="c1">#ts= TSBox(src=&#39;LRG&#39;)</span>
		<span class="c1">#xrange,yrange= xyrange[&#39;x_lrg&#39;],xyrange[&#39;y_lrg&#39;]</span>
		<span class="c1">#ts.add_ts_box(ax[cnt], xlim=xrange,ylim=yrange)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_QSO_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>



	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR_multipanel</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">savekde</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="n">qsos</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qsos</span><span class="p">()</span>
		<span class="n">x</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">y</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
		<span class="n">z</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">d4</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">z</span>
		<span class="n">hiz</span><span class="o">=</span><span class="mf">2.1</span>
		<span class="n">cut</span><span class="o">=</span> <span class="p">(</span><span class="n">d4</span> <span class="o">&lt;=</span> <span class="n">hiz</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">d4</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span><span class="o">*</span>\
			 <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">d4</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r wdust&#39;</span><span class="p">,</span><span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;g-r&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
						   <span class="p">[(</span><span class="mf">15.</span><span class="p">,</span><span class="mf">24.</span><span class="p">),(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="n">hiz</span><span class="p">)],</span>\
						   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>\
						   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mf">15.</span><span class="p">,</span><span class="mi">24</span><span class="p">),</span><span class="n">y1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x1_qso&#39;</span><span class="p">],</span><span class="n">y2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y1_qso&#39;</span><span class="p">],</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">hiz</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span><span class="n">y3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;qso_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_1band_color_and_redshift</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;qso_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span></div>


<div class="viewcode-block" id="GalaxyPrior"><a class="viewcode-back" href="../../index.html#obiwan.priors.GalaxyPrior">[docs]</a><span class="k">class</span> <span class="nc">GalaxyPrior</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Stores all 4 galaxy type classes&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1">#self.qso= QSO()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">star</span><span class="o">=</span> <span class="n">STAR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lrg</span><span class="o">=</span> <span class="n">LRG</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">elg</span><span class="o">=</span> <span class="n">ELG</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">plot_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1">#self.qso.plot()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">star</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lrg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">elg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<span class="k">def</span> <span class="nf">get_parser</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>\
                                     <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Generate a legacypipe-compatible CCDs file </span><span class="se">\</span>
<span class="s1">                                                  from a set of reduced imaging.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--outdir&#39;</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;where to write KDE fits and QA plots&#39;</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span>
 

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span><span class="o">=</span> <span class="n">get_parser</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">outdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>

    <span class="c1">#gals=GalaxyPrior()</span>
    <span class="c1">#gals.plot_all()</span>
    <span class="c1">#print &quot;gals.__dict__= &quot;,gals.__dict__</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">DR</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">loadkde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">savekde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#star=STAR(**kwargs)</span>
    <span class="c1">#star.plot_kde()</span>
    <span class="c1">#star.plot()</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">rlimit</span><span class="o">=</span><span class="mf">22.7</span><span class="o">+</span><span class="mf">1.</span><span class="p">))</span>
    <span class="c1">#qso=QSO(**kwargs)</span>
    <span class="c1">#qso.plot_kde()</span>
    <span class="c1">#qso.plot()</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">DR</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rlimit</span><span class="o">=</span><span class="mf">23.4</span><span class="o">+</span><span class="mf">1.</span><span class="p">))</span>
    <span class="n">elg</span><span class="o">=</span> <span class="n">ELG</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">elg</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">(</span><span class="n">use_acs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#elg.plot_FDR()</span>
    <span class="c1">#elg.plot_FDR_multi()</span>
    <span class="c1">#elg.plot_obiwan_multi()</span>
    <span class="c1">#elg.plot_FDR_mag_dist()</span>
    <span class="c1">#elg.plot_obiwan_mag_dist()</span>
    <span class="c1">#elg.plot_LRG_FDR_wELG_data()</span>
    <span class="c1">#raise ValueError</span>
    <span class="c1">#elg.plot_FDR_multipanel()</span>
    <span class="c1">#elg.get_acs_matched_deep2()</span>
    <span class="c1">#elg.plot_dr3_acs_deep2()</span>
    <span class="c1">#elg.plot_kde_shapes()</span>
    <span class="c1">#elg.plot_kde()</span>
    <span class="c1">#elg.plot_redshift()</span>
    <span class="c1">#elg.cross_validate_redshift()</span>

    <span class="c1">#elg.plot_kde()</span>
    <span class="c1">#elg.plot()</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">zlimit</span><span class="o">=</span><span class="mf">20.46</span><span class="o">+</span><span class="mf">1.</span><span class="p">))</span>
    <span class="n">lrg</span><span class="o">=</span> <span class="n">LRG</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">lrg</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">(</span><span class="n">use_acs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#lrg.plot_dr3_cosmos_acs()</span>
    <span class="c1">#lrg.plot_FDR()</span>
    <span class="c1">#lrg.plot_FDR_multi()</span>
    <span class="c1">#lrg.plot_obiwan_multi()</span>
    <span class="c1">#lrg.plot_FDR_mag_dist()</span>
    <span class="c1">#lrg.plot_obiwan_mag_dist()</span>
    <span class="c1">#lrg.plot_LRG_FDR_mag_dist()</span>
    <span class="c1">#lrg.plot_LRGs_in_ELG_FDR()</span>
    <span class="c1">#lrg.plot_FDR()</span>
    <span class="c1">#lrg.plot_FDR_multipanel()</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="c1">#lrg.plot_kde_shapes()</span>
    <span class="c1">#lrg.plot_kde()</span>
    <span class="c1">#lrg.plot()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2017, DESI Collaboration.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>