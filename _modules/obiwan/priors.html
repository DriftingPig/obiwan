
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obiwan.priors &#8212; obiwan 1.2.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for obiwan.priors</h1><div class="highlight"><pre>
<span></span><span class="c1"># See LICENSE.rst for BSD 3-clause license info</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">====================</span>
<span class="sd">obiwan.priors</span>
<span class="sd">====================</span>

<span class="sd">Uses intrinsic (dust removed) AB fluxes/mags to select ELGs,LRGs,QSOs,STARs</span>
<span class="sd">Makes color-color plots that reproduce the FDR</span>
<span class="sd">Single band, mag distributions, plotted using &#39;as observed&#39; AB fluxes/mags,</span>
<span class="sd">since these are what one adds into a CP image</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="c1">#from astropy.table import vstack, Table</span>
<span class="kn">from</span> <span class="nn">astrometry.util.fits</span> <span class="k">import</span> <span class="n">fits_table</span><span class="p">,</span> <span class="n">merge_tables</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">newton</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">KernelDensity</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="n">urllib</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="k">import</span> <span class="n">scatter_matrix</span>

<span class="kn">from</span> <span class="nn">theValidator.catalogues</span> <span class="k">import</span> <span class="n">CatalogueFuncs</span><span class="p">,</span><span class="n">Matcher</span>

<span class="n">DOWNLOAD_ROOT</span> <span class="o">=</span> <span class="s2">&quot;http://portal.nersc.gov/project/desi/users/kburleigh/obiwan/&quot;</span>
<span class="n">NERSC_ROOT</span> <span class="o">=</span> <span class="n">DOWNLOAD_ROOT</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;http://portal.nersc.gov/project/&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;/global/project/projectdirs/&quot;</span><span class="p">)</span>\
                          <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span><span class="s2">&quot;/www/users/&quot;</span><span class="p">)</span>
<span class="n">OBJTYPES</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;elg&#39;</span><span class="p">,</span><span class="s1">&#39;lrg&#39;</span><span class="p">,</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;qso&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

<span class="k">class</span> <span class="nc">EmptyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../../index.html#obiwan.priors.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fetches and loads truth and catalogue data for star,galaxy populations</span>
<span class="sd">    </span>
<span class="sd">    Stored at: /global/project/projectdirs/desi/www/users/kburleigh/obiwan/priors/</span>
<span class="sd">    Originally at: dr2-dir, /project/projectdirs/desi/target/analysis/truth</span>
<span class="sd">    dr3-dir, /project/projectdirs/desi/users/burleigh/desi/target/analysis/truth</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      img_cuts: dict, set keys to True/False to turn imaging cuts On/Off</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">img_cuts</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">brick_primary</span><span class="o">=</span> <span class="n">img_cuts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">anymask</span><span class="o">=</span> <span class="n">img_cuts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;anymask&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">allmask</span><span class="o">=</span> <span class="n">img_cuts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allmask&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">fracflux</span><span class="o">=</span> <span class="n">img_cuts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fracflux&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outdir</span><span class="p">):</span>
        <span class="n">name</span><span class="o">=</span> <span class="s1">&#39;priors.tar.gz&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tar.gz&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>
        <span class="n">remote_fn</span><span class="o">=</span> <span class="s2">&quot;http://portal.nersc.gov/project/desi/users/kburleigh/obiwan/&quot;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">local_fn</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_fn</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieving </span><span class="si">%s</span><span class="s1">, extracting here </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">remote_fn</span><span class="p">,</span><span class="n">local_fn</span><span class="p">))</span>
            <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">remote_fn</span><span class="p">,</span> <span class="n">local_fn</span><span class="p">)</span>
            <span class="n">tgz</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">local_fn</span><span class="p">)</span>
            <span class="n">tgz</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">outdir</span><span class="p">)</span>
            <span class="n">tgz</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
<div class="viewcode-block" id="Data.load_elg"><a class="viewcode-back" href="../../index.html#obiwan.priors.Data.load_elg">[docs]</a>    <span class="k">def</span> <span class="nf">load_elg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DR</span><span class="p">,</span> <span class="n">rlimit</span><span class="o">=</span><span class="mf">23.4</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args: </span>
<span class="sd">          DR: which Data Release&#39;s data to use</span>
<span class="sd">          rlimit: AB magnitude limit of sample</span>
<span class="sd">            default: is 1 mag deeper than DESI requirement</span>
<span class="sd">        &quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
	    <span class="n">zcat</span> <span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;deep2-field1-oii.fits.gz&#39;</span><span class="p">))</span>
	    <span class="n">R_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_r&#39;</span><span class="p">)</span>
	    <span class="n">rmag_cut</span><span class="o">=</span> <span class="n">R_MAG</span> <span class="o">&lt;</span> <span class="n">rlimit</span> 
	<span class="k">elif</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
	    <span class="n">zcat</span> <span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;deep2f234-dr3matched.fits&#39;</span><span class="p">))</span>
	    <span class="n">decals</span> <span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;dr3-deep2f234matched.fits&#39;</span><span class="p">))</span>
            <span class="c1"># Add mag data </span>
	    <span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
	    <span class="n">rflux</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
	    <span class="n">rmag_cut</span><span class="o">=</span> <span class="n">rflux</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span> <span class="o">-</span> <span class="n">rlimit</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span>
	    <span class="n">rmag_cut</span><span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
	<span class="n">zcat</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">rmag_cut</span><span class="p">)</span> 
	<span class="n">decals</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">rmag_cut</span><span class="p">)</span> 
	<span class="c1"># color data</span>
	<span class="k">if</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
	    <span class="n">G_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_g&#39;</span><span class="p">)</span>
	    <span class="n">R_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_r&#39;</span><span class="p">)</span>
	    <span class="n">Z_MAG</span><span class="o">=</span> <span class="n">zcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfhtls_z&#39;</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
	    <span class="n">G_MAG</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
	    <span class="n">R_MAG</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
	    <span class="n">Z_MAG</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
	    <span class="n">R_MAG_nodust</span><span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
	    <span class="c1"># Don&#39;t need w1, but might be useful</span>
	    <span class="n">W1_MAG</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
	<span class="c1"># Repackage</span>
	<span class="n">tab</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">()</span>
	<span class="c1"># Deep2</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">ra</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">zhelio</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;oii_3727&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">oii_3727</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;oii_3727_err&#39;</span><span class="p">,</span> <span class="n">zcat</span><span class="o">.</span><span class="n">oii_3727_err</span><span class="p">)</span>
	<span class="c1"># Decals</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">,</span> <span class="n">G_MAG</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">,</span> <span class="n">R_MAG</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">,</span> <span class="n">Z_MAG</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;w1_wdust&#39;</span><span class="p">,</span> <span class="n">W1_MAG</span><span class="p">)</span> 
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_nodust&#39;</span><span class="p">,</span> <span class="n">R_MAG_nodust</span><span class="p">)</span>
	<span class="c1"># DR3 shape info</span>
	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]:</span>
	    <span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="c1"># Add shape info from tractor cats</span>
        <span class="n">dic</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tractor_shapes</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">])</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_n&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">tab</span>        </div>
    
     <span class="c1"># def load_elg_acs():</span>
     <span class="c1">#     print(&#39;Matching acs to dr3,deep2&#39;)</span>
     <span class="c1">#     deep= fits_table(os.path.join(self.outdir,</span>
     <span class="c1">#                                   &#39;deep2f1234_acsgcmatched.fits&#39;))</span>
     <span class="c1">#     acs= fits_table(os.path.join(self.outdir,</span>
     <span class="c1">#                                  &#39;acsgc_deep2f1234matched.fits&#39;))</span>
     <span class="c1">#     # Remove ra,dec from acs, then merge</span>
     <span class="c1">#     for key in [&#39;ra&#39;,&#39;dec&#39;]:</span>
     <span class="c1">#         acs.delete_column(key)</span>
     <span class="c1">#     return merge_tables([deep,acs], columns=&#39;fillzero&#39;)</span>
        
<div class="viewcode-block" id="Data.load_lrg"><a class="viewcode-back" href="../../index.html#obiwan.priors.Data.load_lrg">[docs]</a>    <span class="k">def</span> <span class="nf">load_lrg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DR</span><span class="p">,</span><span class="n">zlimit</span><span class="o">=</span><span class="mf">20.46</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args: </span>
<span class="sd">          DR: which Data Release&#39;s data to use</span>
<span class="sd">          zlimit: AB magnitude limit of sample</span>
<span class="sd">            default: is 1 mag deeper than DESI requirement</span>
<span class="sd">        &quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
	    <span class="n">decals</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;decals-dr2-cosmos-zphot.fits.gz&#39;</span><span class="p">)</span> <span class="p">)</span>
	    <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_fits</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;cosmos-zphot.fits.gz&#39;</span><span class="p">)</span> <span class="p">)</span>
	<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
	    <span class="n">decals</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;dr3-cosmoszphotmatched.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
	    <span class="n">spec</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;cosmos-zphot-dr3matched.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
	<span class="c1"># DECaLS</span>
	<span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
	<span class="n">Z_FLUX</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
	<span class="n">W1_FLUX</span> <span class="o">=</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
	<span class="c1"># Cuts</span>
	<span class="c1"># BUG!!</span>
	<span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">Z_FLUX</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span> <span class="o">-</span> <span class="n">zlimit</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">),</span>\
		      <span class="n">W1_FLUX</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">keep</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">decals</span><span class="p">)</span>
	<span class="n">decals</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span> 
	<span class="n">spec</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
	<span class="c1"># Repackage</span>
	<span class="n">tab</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">()</span>
	<span class="c1"># Cosmos</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">ra</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;zp_gal&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">zp_gal</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;type_zphotcomos&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mod_gal&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">mod_gal</span><span class="p">)</span>
	<span class="c1"># DR3</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">])</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">])</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;w1_wdust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">])</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r_nodust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z_nodust&#39;</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">])</span>
        <span class="c1"># DR3 shape info</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]:</span>
            <span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">decals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="c1"># Add tractor shapes</span>
	<span class="n">dic</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tractor_shapes</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">])</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;tractor_n&#39;</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tab</span></div>

    <span class="c1"># def load_lrg_acs(self,DR,zlimit):</span>
    <span class="c1">#     cosmos= self.load_lrg(DR,zlimit)</span>
    <span class="c1">#     acs= fits_table(os.path.join(self.outdir,</span>
    <span class="c1">#                                  &#39;acsgc_cosmosmatched.fits&#39;))</span>
    <span class="c1">#     # WARNING: not sure what this file is</span>
    <span class="c1">#     # cosmos_acsgcmatched.fits</span>
    <span class="c1">#     # Remove ra,dec from acs, then merge</span>
    <span class="c1">#     for key in [&#39;ra&#39;,&#39;dec&#39;]:</span>
    <span class="c1">#         acs.delete_column(key)</span>
    <span class="c1">#     return merge_tables([cosmos,acs], columns=&#39;fillzero&#39;)</span>
    
    <span class="c1"># def load_lrg_vipers(self,DR,zlimit=20.46+1):</span>
    <span class="c1">#     &quot;&quot;&quot;LRGs from VIPERS in CFHTLS W4 field (12 deg2)</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     if DR == 2:</span>
    <span class="c1">#         decals = fits_table(os.path.join(self.outdir,&#39;decals-dr2-vipers-w4.fits.gz&#39;))</span>
    <span class="c1">#         vip = fits_table(os.path.join(self.outdir,&#39;vipers-w4.fits.gz&#39;))</span>
    <span class="c1">#     elif DR == 3:</span>
    <span class="c1">#         decals= fits_table(os.path.join(self.outdir,&#39;dr3-vipersw1w4matched.fits&#39;))</span>
    <span class="c1">#         vip = fits_table(os.path.join(self.outdir,&#39;vipersw1w4-dr3matched.fits&#39;))</span>
    <span class="c1">#     CatalogueFuncs().set_mags_OldDataModel(decals)</span>
    <span class="c1">#     Z_FLUX = decals.get(&#39;decam_flux_nodust&#39;)[:,4]</span>
    <span class="c1">#     W1_FLUX = decals.get(&#39;wise_flux_nodust&#39;)[:,0]</span>
    <span class="c1">#     index={}</span>
    <span class="c1">#     index[&#39;decals&#39;]= np.all((Z_FLUX &gt; 10**((22.5 - zlimit)/2.5),\</span>
    <span class="c1">#     			 W1_FLUX &gt; 0.),axis=0)</span>
    <span class="c1">#     index[&#39;decals&#39;]*= self.imaging_cut(decals)</span>
    <span class="c1">#     # VIPERS</span>
    <span class="c1">#     # https://arxiv.org/abs/1310.1008</span>
    <span class="c1">#     # https://arxiv.org/abs/1303.2623</span>
    <span class="c1">#     flag= vip.get(&#39;zflg&#39;).astype(int)</span>
    <span class="c1">#     index[&#39;good_z&#39;]= np.all((flag &gt;= 2,\</span>
    <span class="c1">#     			 flag &lt;= 9,\</span>
    <span class="c1">#     			 vip.get(&#39;zspec&#39;) &lt; 9.9),axis=0) </span>
    <span class="c1">#     # get Mags</span>
    <span class="c1">#     rz,rW1={},{}</span>
    <span class="c1">#     cut= np.all((index[&#39;decals&#39;],\</span>
    <span class="c1">#     	     index[&#39;good_z&#39;]),axis=0)</span>
    <span class="c1">#     rz= decals.get(&#39;decam_mag_nodust&#39;)[:,2][cut] - decals.get(&#39;decam_mag_nodust&#39;)[:,4][cut]</span>
    <span class="c1">#     rW1= decals.get(&#39;decam_mag_nodust&#39;)[:,2][cut] - decals.get(&#39;wise_mag_nodust&#39;)[:,0][cut]</span>
    <span class="c1">#     return rz,rW1</span>
    
    <span class="k">def</span> <span class="nf">load_star</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DR</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
	    <span class="n">stars</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;Stars_str82_355_4.DECaLS.dr2.fits&#39;</span><span class="p">))</span>
	    <span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span>
	    <span class="n">stars</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_star_cut</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span> <span class="p">)</span>
	<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
	    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stars</span>

    <span class="c1"># def load_star_sweep(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Model the g-r, r-z color-color sequence for stars&quot;&quot;&quot;</span>
    <span class="c1">#     # Build a sample of stars with good photometry from a single sweep.</span>
    <span class="c1">#     rbright = 18</span>
    <span class="c1">#     rfaint = 19.5</span>
    <span class="c1">#     swp_dir=&#39;/global/project/projectdirs/cosmo/data/legacysurvey/dr2/sweep/2.0&#39;</span>
    <span class="c1">#     sweep = self.read_fits(os.path.join(swp_dir,&#39;sweep-340p000-350p005.fits&#39;))</span>
    <span class="c1">#     keep = np.where((sweep.get(&#39;type&#39;) == &#39;PSF &#39;)*</span>
    <span class="c1">#     		(np.sum((sweep.get(&#39;decam_flux&#39;)[:, [1,2,4]] &gt; 0)*1, axis=1)==3)*</span>
    <span class="c1">#     		(np.sum((sweep.get(&#39;DECAM_ANYMASK&#39;)[:, [1,2,4]] &gt; 0)*1, axis=1)==0)*</span>
    <span class="c1">#     	        (np.sum((sweep.get(&#39;DECAM_FRACFLUX&#39;)[:, [1,2,4]] &lt; 0.05)*1, axis=1)==3)*</span>
    <span class="c1">#     		(sweep.get(&#39;decam_flux&#39;)[:,2]&lt;(10**(0.4*(22.5-rbright))))*</span>
    <span class="c1">#     		(sweep.get(&#39;decam_flux&#39;)[:,2]&gt;(10**(0.4*(22.5-rfaint)))))[0]</span>
    <span class="c1">#     stars = sweep[keep]</span>
    <span class="c1">#     print(&#39;dr2stars sample: {}&#39;.format(len(stars)))</span>
    <span class="c1">#     gg = 22.5-2.5*np.log10(stars.get(&#39;decam_flux&#39;)[:, 1])</span>
    <span class="c1">#     rr = 22.5-2.5*np.log10(stars.get(&#39;decam_flux&#39;)[:, 2])</span>
    <span class="c1">#     zz = 22.5-2.5*np.log10(stars.get(&#39;decam_flux&#39;)[:, 4])</span>
    <span class="c1">#     gr = gg - rr</span>
    <span class="c1">#     rz = rr - zz</span>
    <span class="c1">#	return np.array(rz),np.array(gr)</span>

    
<div class="viewcode-block" id="Data.load_qso"><a class="viewcode-back" href="../../index.html#obiwan.priors.Data.load_qso">[docs]</a>    <span class="k">def</span> <span class="nf">load_qso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DR</span><span class="p">,</span><span class="n">rlimit</span><span class="o">=</span><span class="mf">22.7</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args: </span>
<span class="sd">          DR: which Data Release&#39;s data to use</span>
<span class="sd">          rlimit: AB magnitude limit of sample</span>
<span class="sd">            default: is 1 mag deeper than DESI requirement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>        
	    <span class="n">qsos</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;AllQSO.DECaLS.dr2.fits&#39;</span><span class="p">)</span> <span class="p">)</span>
	    <span class="c1"># Add AB mags</span>
	    <span class="n">CatalogueFuncs</span><span class="p">()</span><span class="o">.</span><span class="n">set_mags_OldDataModel</span><span class="p">(</span><span class="n">qsos</span><span class="p">)</span>
	    <span class="n">qsos</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaging_cut</span><span class="p">(</span><span class="n">qsos</span><span class="p">)</span> <span class="p">)</span>
	    <span class="c1"># r &lt; 22.7, grz &gt; 17</span>
	    <span class="n">GFLUX</span> <span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span> 
	    <span class="n">RFLUX</span> <span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
	    <span class="n">ZFLUX</span> <span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span> 
	    <span class="n">GRZFLUX</span> <span class="o">=</span> <span class="p">(</span><span class="n">GFLUX</span> <span class="o">+</span> <span class="mf">0.8</span><span class="o">*</span> <span class="n">RFLUX</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span> <span class="n">ZFLUX</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">2.3</span>
	    <span class="n">cut</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">RFLUX</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span> <span class="o">-</span> <span class="n">rlimit</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">),</span>\
			 <span class="n">GRZFLUX</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="mf">17.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	    <span class="n">qsos</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">cut</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">DR</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
	    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not done yet&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qsos</span></div>
    
<div class="viewcode-block" id="Data.imaging_cut"><a class="viewcode-back" href="../../index.html#obiwan.priors.Data.imaging_cut">[docs]</a>    <span class="k">def</span> <span class="nf">imaging_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;data: tractor catalogue&quot;&quot;&quot;</span>
	<span class="n">cut</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
	<span class="c1"># Brick Primary</span>
	<span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;bool&#39;</span><span class="p">:</span>
	    <span class="n">cut</span><span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
	<span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;S1&#39;</span><span class="p">:</span>
	    <span class="n">cut</span><span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span>
	<span class="k">else</span><span class="p">:</span> 
	    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;brick_primary has type=&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
	<span class="c1">#if self.anymask:</span>
        <span class="c1">#cut*= np.all((data.get(&#39;decam_anymask&#39;)[:, [1,2,4]] == 0),axis=1)</span>
        <span class="c1"># ALL Mask</span>
        <span class="n">cut</span><span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_allmask&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
	<span class="c1"># FracFlux</span>
	<span class="n">cut</span><span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_fracflux&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">cut</span></div>

<div class="viewcode-block" id="Data.std_star_cut"><a class="viewcode-back" href="../../index.html#obiwan.priors.Data.std_star_cut">[docs]</a>    <span class="k">def</span> <span class="nf">std_star_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;See: https://desi.lbl.gov/trac/wiki/TargetSelectionWG/TargetSelection#SpectrophotometricStandardStarsFSTD</span>
<span class="sd">	data is a fits_table object with Tractor Catalogue columns</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">RFLUX_obs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
	<span class="n">GFLUX</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">RFLUX</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span>
	<span class="n">ZFLUX</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
	<span class="n">GRZSN</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_ivar&#39;</span><span class="p">)[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
	<span class="n">GRCOLOR</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">RFLUX</span> <span class="o">/</span> <span class="n">GFLUX</span><span class="p">)</span>
	<span class="n">RZCOLOR</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ZFLUX</span> <span class="o">/</span> <span class="n">RFLUX</span><span class="p">)</span>
	<span class="n">cut</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brick_primary&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span>\
		     <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;PSF&#39;</span><span class="p">,</span>\
		     <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_allmask&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>\
		     <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_fracflux&#39;</span><span class="p">)[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.04</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>\
		     <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">GRZSN</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>\
		     <span class="n">RFLUX_obs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">22.5</span><span class="o">-</span><span class="mf">16.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="c1">#np.power(GRCOLOR - 0.32,2) + np.power(RZCOLOR - 0.13,2) &lt; 0.06**2,\</span>
	<span class="c1">#RFLUX_obs &gt; 10**((22.5-19.0)/2.5)),axis=0)</span>
	<span class="k">return</span> <span class="n">cut</span> </div>
    
<div class="viewcode-block" id="Data.get_tractor_shapes"><a class="viewcode-back" href="../../index.html#obiwan.priors.Data.get_tractor_shapes">[docs]</a>    <span class="k">def</span> <span class="nf">get_tractor_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary of Tractor Catalogue shape measurements</span>

<span class="sd">        Args: </span>
<span class="sd">          cat: tractor catalogues</span>

<span class="sd">        Returns: </span>
<span class="sd">          d: dict of </span>
<span class="sd">            {&#39;re&#39;,&#39;n&#39;,&#39;ba&#39;,&#39;pa&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span><span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">]:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cat</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
        <span class="c1"># Re,N</span>
        <span class="c1"># SIMP</span>
        <span class="c1">#keep= (cat.type == &#39;SIMP&#39;) * (cat.shapeexp_r &gt; 0.)</span>
        <span class="c1">#d[&#39;re&#39;][keep]= cat.shapeexp_r[keep]</span>
        <span class="c1">#d[&#39;n&#39;][keep]= 1.</span>
        <span class="c1"># EXP</span>
        <span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">shapeexp_r</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">shapeexp_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="mf">1.</span>
        <span class="c1"># DEV</span>
        <span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">shapedev_r</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">shapedev_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="mf">4.</span>
        <span class="c1"># BA, PA --&gt; assume radmon dist, so don&#39;t return these</span>
        <span class="c1">#d[&#39;ba&#39;]= np.random.uniform(0.2,1.,size=len(cat))</span>
        <span class="c1">#d[&#39;pa&#39;]= np.random.uniform(0.,180.,size=len(cat))</span>
        <span class="k">return</span> <span class="n">d</span></div></div>

<span class="k">def</span> <span class="nf">inJupyter</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;inline&#39;</span> <span class="ow">in</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">save_png</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="n">path</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">fig_id</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving figure&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="c1">#plt.savefig(path, format=&#39;png&#39;,box_extra_artists=[xlab,ylab],</span>
    <span class="c1">#            bbox_inches=&#39;tight&#39;,dpi=150)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inJupyter</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pyVersion</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span>
        
<div class="viewcode-block" id="save_pickle"><a class="viewcode-back" href="../../index.html#obiwan.priors.save_pickle">[docs]</a><span class="k">def</span> <span class="nf">save_pickle</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves data in &quot;obj&quot; to pickle file&quot;&quot;&quot;</span>
    <span class="c1"># py2 and 3 pickle files not backward compatible</span>
    <span class="n">path</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_py</span><span class="si">%d</span><span class="s2">.pkl&quot;</span> <span class="o">%</span> <span class="n">pyVersion</span><span class="p">())</span>
    <span class="n">fout</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">fout</span><span class="p">)</span>
    <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved pickle&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="load_pickle"><a class="viewcode-back" href="../../index.html#obiwan.priors.load_pickle">[docs]</a><span class="k">def</span> <span class="nf">load_pickle</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads data in pickle file&quot;&quot;&quot;</span>
    <span class="c1"># py2 and 3 pickle files not backward compatible</span>
    <span class="n">path</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_py</span><span class="si">%d</span><span class="s2">.pkl&quot;</span> <span class="o">%</span> <span class="n">pyVersion</span><span class="p">())</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded pickle&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>    </div>

<div class="viewcode-block" id="fits2pandas"><a class="viewcode-back" href="../../index.html#obiwan.priors.fits2pandas">[docs]</a><span class="k">def</span> <span class="nf">fits2pandas</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;converts a fits_table into a pandas DataFrame</span>

<span class="sd">    Args:</span>
<span class="sd">      tab: fits_table()</span>
<span class="sd">      attrs: attributes or column names want in the DF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">attrs</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">get_columns</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>
<span class="c1"># pd.iloc([inds,:])</span>
 

<div class="viewcode-block" id="KDE_Model"><a class="viewcode-back" href="../../index.html#obiwan.priors.KDE_Model">[docs]</a><span class="k">class</span> <span class="nc">KDE_Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fits a Kernel Density Estimate (KDE) to a given source population</span>
<span class="sd">    </span>
<span class="sd">    Only one source or data table per KDE_Model object </span>

<span class="sd">    Args:</span>
<span class="sd">      src: elg,lrg, etc</span>
<span class="sd">      data: tractor catalogue for the population </span>
<span class="sd">        returned by Data().load_elg(), for elgs </span>
<span class="sd">      outdir: output dir</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">      data: copy of data</span>
<span class="sd">      outdir:</span>
<span class="sd">      kde: fit KDE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">src</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">outdir</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">src</span> <span class="ow">in</span> <span class="n">OBJTYPES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">=</span> <span class="n">src</span>
        <span class="c1"># DF instead of fits_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">=</span> <span class="n">fits2pandas</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keys_for_KDE</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;kdes&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">keys_for_KDE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">src</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">OBJTYPES</span>
        <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;elg&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;zhelio&#39;</span><span class="p">,</span><span class="s1">&#39;oii_3727&#39;</span><span class="p">,</span><span class="s1">&#39;oii_3727_err&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;r_wdust&#39;</span><span class="p">,</span><span class="s1">&#39;z_wdust&#39;</span><span class="p">,</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">,</span><span class="s1">&#39;tractor_re&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;lrg&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;star&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;qso&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        
    <span class="k">def</span> <span class="nf">get_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span><span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-kde&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">df_for_kde</span><span class="p">,</span><span class="n">kde</span><span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c1"># Doesn&#39;t exist yet</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;elg&#39;</span><span class="p">:</span>
                <span class="n">kde</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_elg</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;lrg&#39;</span><span class="p">:</span>
                <span class="n">kde</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_lrg</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;star&#39;</span><span class="p">:</span>
                <span class="n">kde</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_star</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;qso&#39;</span><span class="p">:</span>
                <span class="n">kde</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_qso</span><span class="p">()</span>
            <span class="n">save_pickle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">df_for_kde</span><span class="p">,</span><span class="n">kde</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kde</span>
    
<div class="viewcode-block" id="KDE_Model.fit_kde"><a class="viewcode-back" href="../../index.html#obiwan.priors.KDE_Model.fit_kde">[docs]</a>    <span class="k">def</span> <span class="nf">fit_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span>
                <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fits a KDE to the data</span>
<span class="sd">        </span>
<span class="sd">        Following </span>
<span class="sd">          http://scikit-learn.org/stable/auto_examples/neighbors/plot_kde_1d.html</span>
<span class="sd">        </span>
<span class="sd">        Args: </span>
<span class="sd">          X: numpy array of shape [m instances, N features]</span>
<span class="sd">          bandwidth: characteristic width of the kernel</span>
<span class="sd">          kernel: gaussian, tophat, etc</span>
<span class="sd">          </span>
<span class="sd">        Returns: </span>
<span class="sd">          KernelDensity() object fit to data_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
                             <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">fit_elg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># CUTS</span>
        <span class="c1"># Sample that represents population</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fitting elg!!&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> \
	      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;=</span> <span class="mf">1.4</span><span class="p">)</span> <span class="o">*</span> \
	      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">*</span> \
	      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
	<span class="c1"># Finite values</span>
	<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
	    <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
		<span class="k">continue</span>
	    <span class="n">keep</span> <span class="o">*=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>
        <span class="c1"># Real size</span>
	<span class="n">keep</span><span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tractor_re</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
        <span class="c1"># DF to fit on</span>
        <span class="n">d</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">r_wdust</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">,</span>
                <span class="n">rz_wdust</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">.</span><span class="n">r_wdust</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">,</span>
		<span class="n">gr_wdust</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">.</span><span class="n">g_wdust</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">,</span>
                <span class="n">zhelio</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">.</span><span class="n">zhelio</span><span class="p">,</span>
		<span class="n">tractor_re</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_wcut</span><span class="o">.</span><span class="n">tractor_re</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_for_kde</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_for_kde</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
			    <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_lrg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="c1"># Cut to sample that repr. population</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type_zphotcomos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
		       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">))</span> 
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_cosmos after obiwan cuts: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="c1"># Only finite vals</span>
	<span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="nb">bool</span><span class="p">)</span> 
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
	    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
		<span class="k">continue</span>
	    <span class="n">keep</span> <span class="o">*=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">))</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_cosmos after finite cuts: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
	<span class="c1"># physical</span>
	<span class="n">tab</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
	<span class="c1"># Reshift needs be &gt; 0</span>
	<span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">zp_gal</span> <span class="o">-</span> <span class="n">bandwidth</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dr3_cosmos after redshift &gt; </span><span class="si">%f</span><span class="s1">: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bandwidth</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">([</span><span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">,</span> 
			     <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">w1_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">zp_gal</span><span class="p">,</span> 
			     <span class="n">tab</span><span class="o">.</span><span class="n">g_wdust</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">tractor_re</span><span class="p">],</span>
			    <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_star</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">],</span>
                             <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>
                             <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]],</span>
			    <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_qso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Sample</span>
	<span class="n">hiz</span><span class="o">=</span><span class="mf">2.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;=</span> <span class="n">hiz</span><span class="p">)</span><span class="o">*</span>\
                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">))</span>
        <span class="c1"># Finite vals</span>
	<span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="nb">bool</span><span class="p">)</span> 
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
	    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
		<span class="k">continue</span>
	    <span class="n">keep</span> <span class="o">*=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">))</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_wdust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">z</span><span class="p">],</span>
                            <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">)</span> </div>

<span class="k">class</span> <span class="nc">KernelOfTruth</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># 1D histograms of each dim of KDE</span>
    <span class="k">def</span> <span class="nf">plot_indiv_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="c1"># Data</span>
            <span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="c1"># KDE distribution</span>
            <span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lims</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
            <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;kde_1d_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>

    <span class="c1"># 2D scatterplot of selected dims of KDE</span>

    <span class="k">def</span> <span class="nf">plot_FDR_using_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">,</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">obj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;LRG&#39;</span><span class="p">,</span><span class="s1">&#39;ELG&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">use_data</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">]:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="c1"># Add box</span>
            <span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">lower</span><span class="p">()],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
            <span class="c1"># xyrange dashed box</span>
            <span class="c1">#for i in range(2):</span>
            <span class="c1">#    ax[i].plot([xrange[i],xrange[i]],yrange,&#39;k--&#39;)</span>
            <span class="c1">#    ax[i].plot(xrange,[yrange[i],yrange[i]],&#39;k--&#39;)</span>
            <span class="c1"># KDE sample</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
                <span class="n">xname</span><span class="o">=</span> <span class="s1">&#39;rz&#39;</span>
                <span class="n">yname</span><span class="o">=</span> <span class="s1">&#39;rw1&#39;</span>
            <span class="k">elif</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
                <span class="n">xname</span><span class="o">=</span> <span class="s1">&#39;rz&#39;</span>
                <span class="n">yname</span><span class="o">=</span> <span class="s1">&#39;gr&#39;</span>
            <span class="n">ix</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">xname</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">iy</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">yname</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">use_data</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">ix</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">iy</span><span class="p">],</span>
                           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;kde_in_FDR_Data_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">ix</span><span class="p">],</span><span class="n">samp</span><span class="p">[:,</span><span class="n">iy</span><span class="p">],</span>
                           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">)</span>
                <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;kde_in_FDR_KDE_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
            <span class="c1"># finish</span>
            <span class="c1">#ax.set_xlim(xrange[0]-1,xrange[1]+1)</span>
            <span class="c1">#ax.set_ylim(yrange[0]-1,yrange[1]+1)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
                <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
                <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obj</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
                <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
                <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outdir</span><span class="p">:</span>
                <span class="n">savenm</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">savenm</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nb</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">plot_1band_and_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xylims -- dict of x1,y1,x2,y2,... where x1 is tuple of low,hi for first plot xaxis&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># Data</span>
        <span class="n">xyz</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>\
                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># KDE distribution</span>
        <span class="n">xyz</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>\
                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;lrg_&#39;</span><span class="p">:</span>
            <span class="c1"># plot g band distribution even though no Targeting cuts on g</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">])</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">g_kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">plot_1band_color_and_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xylims -- dict of x1,y1,x2,y2,... where x1 is tuple of low,hi for first plot xaxis&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># Colormap the color-color plot by redshift</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
        <span class="n">bounds</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="c1"># Data</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># color bar with color plot</span>
        <span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span>\
                                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>\
                                 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
                                 <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
                             <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
        <span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#Xtest= np.linspace(-0.2,1.6,num=100)</span>
        <span class="c1">#log_dens = self.kde.score_samples(self.X)</span>
        <span class="c1">#ax[0,2].plot(self.X[:,3], np.exp(log_dens), &#39;y-&#39;)</span>
        <span class="c1"># KDE distribution</span>
        <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>\
                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
        <span class="n">sname</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">sname</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;lrg_&#39;</span><span class="p">:</span>
            <span class="c1"># plot g band distribution even though no Targeting cuts on g</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x4&#39;</span><span class="p">])</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">])</span>
            <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
            <span class="n">sname</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">g_kde.png&#39;</span> <span class="o">%</span> <span class="n">prefix</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">sname</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_galaxy_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kde.png&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xylims -- dict of x1,y1,x2,y2,... where x1 is tuple of low,hi for first plot xaxis&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">samp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">ndraws</span><span class="p">)</span>
        <span class="c1"># ba,pa can be slightly greater 1.,180</span>
        <span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span> <span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.</span> <span class="p">]</span><span class="o">=</span> <span class="mf">1.</span>
        <span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">][</span> <span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">180.</span> <span class="p">]</span><span class="o">=</span> <span class="mf">180.</span>
        <span class="c1"># Physical values</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span>\
                      <span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span>\
                      <span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">)))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span>\
                      <span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">)))</span>
        <span class="c1"># plot</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="c1"># Data</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># KDE distribution</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">cnt</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># lims</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">xylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;x</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                    <span class="c1">#ax[cnt,1].set_xlim(xylims[&#39;x2&#39;])</span>
                    <span class="c1">#ax[cnt,2].set_xlim(xylims[&#39;x3&#39;])</span>
                    <span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
                    <span class="c1">#xlab=ax[cnt,1].set_xlabel(self.labels[1],fontsize=&#39;x-large&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">get_rgb_cols</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),(</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span>\
            <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>\
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>


<span class="c1"># Globals</span>
<span class="n">xyrange</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_star</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">],</span>\
             <span class="n">y_star</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.</span><span class="p">],</span>\
             <span class="n">x_elg</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">],</span>\
             <span class="n">y_elg</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.</span><span class="p">],</span>\
             <span class="n">x_lrg</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span>\
             <span class="n">y_lrg</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>\
             <span class="n">x1_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.</span><span class="p">],</span>\
             <span class="n">y1_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span>\
             <span class="n">x2_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span>\
             <span class="n">y2_qso</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>

<div class="viewcode-block" id="rm_last_ticklabel"><a class="viewcode-back" href="../../index.html#obiwan.priors.rm_last_ticklabel">[docs]</a><span class="k">def</span> <span class="nf">rm_last_ticklabel</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;for multiplot&quot;&quot;&quot;</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="c1">#prevent from making float</span>
    <span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></div>



        
    
<div class="viewcode-block" id="Plot"><a class="viewcode-back" href="../../index.html#obiwan.priors.Plot">[docs]</a><span class="k">class</span> <span class="nc">Plot</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Makes relavent plots for a given src using data,kde      </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      data: tractor catalogue for source population</span>
<span class="sd">      kde: Fit KDE returned by FitKDE()</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outdir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;plots&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">elg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">df_wcut</span><span class="p">,</span><span class="n">df_for_kde</span><span class="p">,</span><span class="n">kde</span><span class="p">):</span>
        <span class="n">src</span><span class="o">=</span> <span class="s1">&#39;elg&#39;</span>
        <span class="c1"># Pandas built in</span>
        <span class="n">df_wcut</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">save_png</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_hist_df_wcut&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span>
        <span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df_wcut</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="n">save_png</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_scat_df_wcut&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span>
        <span class="c1">####</span>
        <span class="n">df_for_kde</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">save_png</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_hist_df_for_kde&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span>
        <span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df_for_kde</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="n">save_png</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_scat_df_for_kde&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span>
        <span class="c1">###</span>
        <span class="n">samp</span><span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">df_samp</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samp</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="n">df_for_kde</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">df_samp</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
        <span class="n">save_png</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_hist_df_samp&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span>
        <span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df_samp</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="n">save_png</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_scat_df_samp&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lrg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">kde</span><span class="p">):</span>
        <span class="n">src</span><span class="o">=</span><span class="s1">&#39;lrg&#39;</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">star</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">kde</span><span class="p">):</span>
        <span class="n">src</span><span class="o">=</span><span class="s1">&#39;star&#39;</span>
	<span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">qso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">kde</span><span class="p">):</span>
        <span class="n">src</span><span class="o">=</span><span class="s1">&#39;qso&#39;</span>
        <span class="k">pass</span></div>



<div class="viewcode-block" id="TSBox"><a class="viewcode-back" href="../../index.html#obiwan.priors.TSBox">[docs]</a><span class="k">class</span> <span class="nc">TSBox</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add FDR Target Selection box to any  ELG, LRG, plot</span>
<span class="sd">    </span>
<span class="sd">	Args:</span>
<span class="sd">		src: ELG, LRG, QSO, STAR</span>

<span class="sd">	Attributes:</span>
<span class="sd">		src: ELG, LRG, QSO, STAR</span>
<span class="sd">		</span>
<span class="sd">	Note: </span>
<span class="sd">		add_ts_box(): primary function to use</span>
<span class="sd">	&quot;&quot;&quot;</span>
	
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">=</span><span class="n">src</span>

<div class="viewcode-block" id="TSBox.add_ts_box"><a class="viewcode-back" href="../../index.html#obiwan.priors.TSBox.add_ts_box">[docs]</a>    <span class="k">def</span> <span class="nf">add_ts_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;draw color selection box&quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
            <span class="c1">#g-r vs. r-z</span>
            <span class="n">xint</span><span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_root</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;y1-y2&#39;</span><span class="p">,))</span>
            
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">)</span>
            <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">y</span>
            <span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">y</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.3</span><span class="p">,</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xint</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y1</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xint</span><span class="p">,</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">1.6</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y2</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">y3</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
            <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="o">=</span> <span class="n">x3</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y3</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">y4</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="o">=</span> <span class="n">x4</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y4</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
            <span class="c1">#r-w1 vs. r-z</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">y</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">1.5</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y1</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">b</span><span class="o">=</span> <span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">y2</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;src=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="n">src</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">ts_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="mf">1.15</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="mf">0.15</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y2&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mf">1.2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mf">1.6</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;LRG&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="mf">1.8</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="mf">1.</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;src=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ts_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;ELG&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;y1-y2&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;non ELG not supported&#39;</span><span class="p">)</span></div>

        
<span class="k">class</span> <span class="nc">FDR_elg</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>    
    <span class="k">def</span> <span class="nf">get_FDR_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
	<span class="n">oiicut1</span> <span class="o">=</span> <span class="mf">8E-17</span> <span class="c1"># [erg/s/cm2]</span>
	<span class="n">zmin</span> <span class="o">=</span> <span class="mf">0.6</span>
	<span class="n">keep</span><span class="o">=</span> <span class="p">{}</span>
	<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;lowz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;</span> <span class="n">zmin</span>
	<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;</span> <span class="n">zmin</span><span class="p">,</span>\
				     <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span>\
				     <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&lt;</span> <span class="n">oiicut1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;</span> <span class="n">zmin</span><span class="p">,</span>\
				    <span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span>\
				    <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span>\
				    <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&gt;</span> <span class="n">oiicut1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">tab</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">,</span>\
				   <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727_err</span> <span class="o">!=-</span><span class="mf">2.0</span><span class="p">,</span>\
				   <span class="n">tab</span><span class="o">.</span><span class="n">oii_3727</span> <span class="o">&gt;</span> <span class="n">oiicut1</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">keep</span> 		 
    
    <span class="k">def</span> <span class="nf">plot_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">r_nodust</span><span class="p">,</span><span class="n">r_wdust</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elgs_FDR_cuts</span><span class="p">()</span>
	<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
	<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
	<span class="c1"># Plot</span>
	<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
	<span class="c1"># Plot data</span>
	<span class="n">zbins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
	<span class="n">mysvm</span><span class="p">,</span><span class="n">mynn</span><span class="p">,</span><span class="n">categors</span><span class="o">=</span><span class="p">{},{},{}</span>
	<span class="c1"># Plot, Predict, Predict</span>
	<span class="c1"># Discrete Color Map</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
	<span class="n">bounds</span> <span class="o">=</span> <span class="n">zbins</span>
	<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
	<span class="c1"># Make plots</span>
	<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
			      <span class="p">[</span><span class="s1">&#39;goodz_oiibright&#39;</span><span class="p">,</span><span class="s1">&#39;goodz_oiifaint&#39;</span><span class="p">],</span>\
			      <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z=(0.8,1.4) [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z=(0.8,1.4) [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">]):</span>
	    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Learning redshifts for sample=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
	    <span class="c1"># Add box</span>
	    <span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="c1"># Scatter</span>
	    <span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>\
				     <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
				     <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
	    <span class="n">title</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
	    <span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">])</span>
	    <span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
	    <span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
				 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
	    <span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
	    <span class="c1">#cbar = fig.colorbar(axobj, orientation=&#39;vertical&#39;)</span>
	    <span class="c1"># Train &amp; Predict</span>
	    <span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
	    <span class="k">for</span> <span class="n">ithbin</span><span class="p">,</span><span class="n">lft</span><span class="p">,</span><span class="n">rt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zbins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">zbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">zbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
		<span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">][</span> <span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lft</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">redshift</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rt</span><span class="p">)</span> <span class="p">]</span><span class="o">=</span> <span class="n">ithbin</span><span class="o">+</span><span class="mi">1</span>
		<span class="n">X</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
		<span class="n">mysvm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">RedshiftPredictor</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
		<span class="n">mysvm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">svm</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="c1"># FIX!!!! ADD 5 color color bar, len(zbins)-1, </span>
		<span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">mysvm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>\
					 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>\
					 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
					 <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="c1">#cbar = fig.colorbar(axobj, orientation=&#39;vertical&#39;)</span>
		<span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">cnt</span><span class="p">])</span>
		<span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
				     <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
		<span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
		<span class="c1"># FIX add lines dividing the two samples, see sklearn doc plot examples</span>
		<span class="c1"># Train &amp; Predict</span>
		<span class="n">mynn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">RedshiftPredictor</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">categors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">mynn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">nn</span><span class="p">(</span><span class="n">nn</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="c1"># FIX!!!! ADD 5 color color bar, len(zbins)-1, </span>
		<span class="n">axobj</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">mynn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>\
					 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>\
					 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>\
					 <span class="n">vmin</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="c1">#cbar = fig.colorbar(axobj, orientation=&#39;vertical&#39;)</span>
		<span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">cnt</span><span class="p">])</span>
		<span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axobj</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span>\
				     <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
		<span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
	    <span class="c1"># Finish axes</span>
	    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
		<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
		    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
		    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
		    <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
	    <span class="c1"># Save</span>
	    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_redshifts.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
	    <span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">cbar3</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">])</span> <span class="c1">#, bbox_inches=&#39;tight&#39;,dpi=150)</span>
	    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">plot_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
	<span class="c1"># Cuts &#39;lowz&#39;,&#39;medz_lowO2&#39; ...</span>
	<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
	<span class="c1"># Plot</span>
	<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
	<span class="c1"># Add box</span>
	<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
	<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
	<span class="c1"># Add points</span>
	<span class="k">for</span> <span class="n">cut_name</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">marker</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;lowz&#39;</span><span class="p">,</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">,</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">,</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">],</span>
					    <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span>
					     <span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">],</span>
					     <span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>
					     <span class="p">[</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]):</span>
	    <span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
	    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span> 
		       <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
	    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
	    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
	    <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
	    <span class="n">leg</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
			  <span class="n">markerscale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
	    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_ELG.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
	    <span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">plot_FDR_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
	<span class="c1"># Cuts &#39;lowz&#39;,&#39;medz_lowO2&#39; ...</span>
	<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
	<span class="c1"># Plot</span>
	<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
	<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">marker</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						 <span class="p">[</span><span class="s1">&#39;lowz&#39;</span><span class="p">,</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">,</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">,</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">],</span>
						 <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span>
						  <span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">],</span>
						 <span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>
						 <span class="p">[</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]):</span>
            <span class="c1"># Add box</span>
	    <span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="c1"># Add points</span>
	    <span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
	    <span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
	    <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
	<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_FDR_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
	<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">plot_obiwan_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
	<span class="c1"># Cuts &#39;lowz&#39;,&#39;medz_lowO2&#39; ...</span>
	<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
	<span class="c1"># Plot</span>
	<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
	<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
					<span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
					<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$0.8&lt;z&lt;1.4, [OII] &gt; 0$&#39;</span><span class="p">,</span><span class="s1">&#39;Everything else&#39;</span><span class="p">],</span>
					<span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]):</span>
	    <span class="c1"># Add box</span>
	    <span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="c1"># Add points</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
	    <span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
	    <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
	    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_obiwan_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
	    <span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
	    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">plot_LRG_FDR_wELG_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="n">dic</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elgs_FDR_cuts</span><span class="p">()</span>
	<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
	<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
	<span class="c1"># Plot</span>
	<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>\
					 <span class="p">[</span><span class="s1">&#39;loz&#39;</span><span class="p">,</span><span class="s1">&#39;oiifaint&#39;</span><span class="p">,</span><span class="s1">&#39;oiibright_loz&#39;</span><span class="p">,</span><span class="s1">&#39;oiibright_hiz&#39;</span><span class="p">],</span>\
					 <span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>\
					 <span class="p">[</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>\
					 <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">]):</span>
	    <span class="c1"># Add box</span>
	    <span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="c1"># Add points</span>
	    <span class="n">b</span><span class="o">=</span> <span class="n">key</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;rz&#39;</span><span class="p">][</span><span class="n">b</span><span class="p">],</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;rw1&#39;</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
	    <span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
	    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
	    <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
	    <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
	<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_FDR_wELG_data.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
	<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            
	<span class="k">def</span> <span class="nf">plot_FDR_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						<span class="p">[</span><span class="s1">&#39;lowz&#39;</span><span class="p">,</span><span class="s1">&#39;medz_lowO2&#39;</span><span class="p">,</span><span class="s1">&#39;medz_hiO2&#39;</span><span class="p">,</span><span class="s1">&#39;hiz_hiO2&#39;</span><span class="p">],</span>
						<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$z&lt;0.6$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&lt;8\times10^{-17}$&#39;</span><span class="p">,</span>
							<span class="sa">r</span><span class="s1">&#39;$z&gt;0.6, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$z&gt;1.0, [OII]&gt;8\times10^{-17}$&#39;</span><span class="p">]):</span>
			<span class="c1"># Mag data</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span> <span class="o">+</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mag&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
			<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_mag_dist_FDR.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_obiwan_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_deep2</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						<span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
						<span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$0.8&lt;z&lt;1.4, [OII] &gt; 0$&#39;</span><span class="p">,</span><span class="s1">&#39;Everything else&#39;</span><span class="p">]):</span>
			<span class="c1"># Mag data</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">thecut</span><span class="p">]</span> <span class="o">+</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">]</span> <span class="o">-</span> <span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">thecut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti_loc</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mag&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
			<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_ELG_mag_dist_obiwan.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti_loc</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR_multipanel</span><span class="p">()</span>
		<span class="c1">#plot_FDR(self.Xall,self.cuts,src=&#39;ELG&#39;)</span>
		<span class="c1">#b= self.cuts[&#39;any_elg&#39;]</span>
		<span class="c1">#color_color_plot(self.Xall[b,:],src=&#39;ELG&#39;,append=&#39;_FDR&#39;) #,extra=True)</span>
		<span class="c1">#Xall,cuts, morph= elg_data()</span>
		<span class="c1">#color_color_plot(Xall, src=&#39;ELG&#39;,append=&#39;_synth&#39;) #,extra=True)</span>
		<span class="c1">#b= cuts[&#39;has_morph&#39;]</span>
		<span class="c1">#color_color_plot(Xall[b,:],src=&#39;ELG&#39;,append=&#39;_synth+morph&#39;) #,extra=True)</span>

	<span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">r_nodust</span><span class="p">,</span><span class="n">r_wdust</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">x</span><span class="o">=</span> <span class="n">r_wdust</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">y</span><span class="o">=</span> <span class="n">rz</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">z</span><span class="o">=</span> <span class="n">gr</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">d4</span><span class="o">=</span> <span class="n">redshift</span><span class="p">[</span><span class="s1">&#39;med2hiz_oiibright&#39;</span><span class="p">]</span>
		<span class="n">cut</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">d4</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r wdust&#39;</span><span class="p">,</span><span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;g-r&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
							   <span class="p">[(</span><span class="mf">20.5</span><span class="p">,</span><span class="mf">25.</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">)],</span>\
							   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
							   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mf">25.5</span><span class="p">),</span><span class="n">y1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">y2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">],</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),</span><span class="n">y3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;elg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_1band_color_and_redshift</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;elg_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">plot_kde_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_matched_deep2</span><span class="p">()</span>
		<span class="n">pa</span><span class="o">+=</span> <span class="mf">90.</span> <span class="c1"># 0-180 deg</span>
		<span class="c1">#cut= (np.isfinite(x))* (np.isfinite(y))* (np.isfinite(z))</span>
		<span class="c1">#x,y,z,d4= x[cut],y[cut],z[cut],d4[cut]</span>
		<span class="c1"># ba &gt; 0</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
							   <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">10.</span><span class="p">),(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">180.</span><span class="p">)],</span>\
							   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
							   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>\
					<span class="n">x4</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;elg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_galaxy_shapes</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;elg_shapes_kde.png&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FDR_lrg</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">get_FDR_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
		<span class="n">keep</span><span class="o">=</span><span class="p">{}</span>  
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span>\
							 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span>\
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">zp_gal</span> <span class="o">&lt;=</span> <span class="mf">0.6</span><span class="p">)</span>
		<span class="n">keep</span><span class="p">[</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">mod_gal</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span>\
								 <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">zp_gal</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>

                        
	<span class="k">def</span> <span class="nf">plot_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="c1"># Add box</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
		<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
		<span class="c1"># Data</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
						<span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">rW1</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
					   <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">cut_name</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="n">leg</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>\
					  <span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_LRG.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>   
					   <span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">rW1</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
							<span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cut_name</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
			<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_FDR_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_obiwan_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>   
								  <span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
								  <span class="p">[</span><span class="s1">&#39;red galaxy&#39;</span><span class="p">,</span><span class="s1">&#39;everything else&#39;</span><span class="p">],</span>
								  <span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span><span class="n">tab</span><span class="o">.</span><span class="n">rW1</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
							<span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cut_name</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
			<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_obiwan_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">plot_LRGs_in_ELG_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">data</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lrgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="n">keys</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">keys</span><span class="p">,</span><span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rz&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;g_wdust&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_wdust&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span>
							<span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_elg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_elg&#39;</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
			<span class="c1"># Add box</span>
			<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRGs_in_ELG_FDR.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_FDR_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">cut_name</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
					<span class="p">[</span><span class="s1">&#39;star&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_lowz&#39;</span><span class="p">,</span><span class="s1">&#39;red_galaxy_hiz&#39;</span><span class="p">,</span><span class="s1">&#39;blue_galaxy&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="c1"># Mag data</span>
			<span class="n">cut</span><span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">cut_name</span><span class="p">]</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">g_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">[</span><span class="n">cut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cut_name</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mags&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_mag_dist_FDR.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_obiwan_mag_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tab</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dr3_cosmos</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obiwan_cuts</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb_cols</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">thecut</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
					<span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
					<span class="p">[</span><span class="s1">&#39;red galaxy&#39;</span><span class="p">,</span><span class="s1">&#39;everything else&#39;</span><span class="p">],</span>
									<span class="n">rgb_cols</span><span class="p">):</span>
			<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
			<span class="c1"># Mag data</span>
			<span class="n">mags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">r_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">g</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">g_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">],</span>
					  <span class="n">z</span><span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">z_wdust</span><span class="p">[</span><span class="n">thecut</span><span class="p">])</span> 
			<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
				<span class="c1"># nans present</span>
				<span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">][</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="p">]</span>
				<span class="c1"># histograms</span>
				<span class="n">h</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
				<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
			<span class="n">ti</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AB mags&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_mag_dist_obiwan.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">ti</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_vipers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">rW1</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vipers</span><span class="p">()</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">rgb</span><span class="o">=</span><span class="n">get_rgb_cols</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">rgb</span><span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">,</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">rW1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">rgb</span><span class="p">],</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#,label=key)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">])</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W1&#39;</span><span class="p">)</span>
		<span class="c1"># Add box</span>
		<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;LRG&#39;</span><span class="p">)</span>
		<span class="n">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span> <span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">]</span>
		<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>
		<span class="c1">#handles,labels = ax.get_legend_handles_labels()</span>
		<span class="c1">#index=[0,1,2,3]</span>
		<span class="c1">#handles,labels= np.array(handles)[index],np.array(labels)[index]</span>
		<span class="c1">#leg=ax.legend(handles,labels,loc=(0,1.05),ncol=2,scatterpoints=1,markerscale=2)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_LRG_vipers.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR_multipanel</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_vipers</span><span class="p">()</span>
		<span class="c1">#plot_FDR(self.Xall,self.cuts,src=&#39;LRG&#39;)</span>
		<span class="c1">#color_color_plot(self.Xall,src=&#39;LRG&#39;,append=&#39;cc&#39;) #,extra=True)</span>
		<span class="c1">#b= self.cuts[&#39;lrg&#39;)</span>
		<span class="c1">#color_color_plot(self.Xall[b,:],src=&#39;LRG&#39;) #,extra=True)</span>

	<span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">savekde</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;No Targeting cuts on g band, but need to fit it so can insert in grz image&quot;&quot;&quot;</span>
		<span class="n">rz</span><span class="p">,</span><span class="n">rW1</span><span class="p">,</span><span class="n">r_nodust</span><span class="p">,</span><span class="n">r_wdust</span><span class="p">,</span><span class="n">z_nodust</span><span class="p">,</span><span class="n">z_wdust</span><span class="p">,</span><span class="n">g_wdust</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lrgs_FDR_cuts</span><span class="p">()</span>
		<span class="n">x</span><span class="o">=</span> <span class="n">z_wdust</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">y</span><span class="o">=</span> <span class="n">rz</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">z</span><span class="o">=</span> <span class="n">rW1</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">d4</span><span class="o">=</span> <span class="n">redshift</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">M</span><span class="o">=</span> <span class="n">g_wdust</span><span class="p">[</span><span class="s1">&#39;red_galaxy&#39;</span><span class="p">]</span>
		<span class="n">cut</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">z</span><span class="p">))</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
		<span class="c1"># Redshift &gt; 0 given bandwidth</span>
		<span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span>
		<span class="n">cut</span><span class="o">*=</span> <span class="p">(</span><span class="n">d4</span> <span class="o">-</span> <span class="n">bandwidth</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="p">,</span><span class="n">M</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">d4</span><span class="p">[</span><span class="n">cut</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="n">cut</span><span class="p">]</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z wdust&#39;</span><span class="p">,</span><span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;r-W1&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;g wdust&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">d4</span><span class="p">,</span><span class="n">M</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
						   <span class="p">[(</span><span class="mf">17.</span><span class="p">,</span><span class="mf">22.</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">),(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">5.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),(</span><span class="mf">17.</span><span class="p">,</span><span class="mi">29</span><span class="p">)],</span>\
						   <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
						   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="mf">17.</span><span class="p">,</span><span class="mf">22.</span><span class="p">),</span><span class="n">y1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x_lrg&#39;</span><span class="p">],</span><span class="n">y2</span><span class="o">=</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y_lrg&#39;</span><span class="p">],</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),</span><span class="n">y3</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span>\
					<span class="n">x4</span><span class="o">=</span><span class="p">(</span><span class="mf">17.</span><span class="p">,</span><span class="mi">29</span><span class="p">),</span><span class="n">y4</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.7</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;lrg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_1band_color_and_redshift</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;lrg_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdefn</span><span class="p">)</span>


	<span class="k">def</span> <span class="nf">plot_kde_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_matched_cosmoszphot</span><span class="p">()</span>
		<span class="n">pa</span><span class="o">+=</span> <span class="mf">90.</span> <span class="c1"># 0-180 deg</span>
		<span class="c1">#cut= (np.isfinite(x))* (np.isfinite(y))* (np.isfinite(z))</span>
		<span class="c1">#x,y,z,d4= x[cut],y[cut],z[cut],d4[cut]</span>
		<span class="c1"># ba &gt; 0</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">]</span>
		<span class="n">kde_obj</span><span class="o">=</span> <span class="n">KernelOfTruth</span><span class="p">([</span><span class="n">re</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">pa</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span>\
							   <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">10.</span><span class="p">),(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">),(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">180.</span><span class="p">)],</span>\
							   <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;tophat&#39;</span><span class="p">,</span>\
							   <span class="n">kdefn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">,</span><span class="n">loadkde</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadkde</span><span class="p">)</span>
		<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span>\
					<span class="n">x2</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>\
					<span class="n">x3</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">),</span>\
					<span class="n">x4</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>
		<span class="c1">#kde_obj.plot_1band_and_color(ndraws=1000,xylims=xylims,prefix=&#39;elg_&#39;)</span>
		<span class="n">kde_obj</span><span class="o">.</span><span class="n">plot_galaxy_shapes</span><span class="p">(</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">xylims</span><span class="o">=</span><span class="n">xylims</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lrg_shapes_kde.png&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savekde</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span>
			<span class="n">kde_obj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde_shapes_fn</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FDR_qso</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">plot_FDR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Data</span>
		<span class="n">qsos</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qsos</span><span class="p">()</span>
		<span class="n">star_obj</span><span class="o">=</span> <span class="n">STAR</span><span class="p">(</span><span class="n">DR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DR</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="n">stars</span><span class="o">=</span> <span class="n">star_obj</span><span class="o">.</span><span class="n">get_purestars</span><span class="p">()</span>
		<span class="n">hiz</span><span class="o">=</span><span class="mf">2.1</span>
		<span class="n">index</span><span class="o">=</span><span class="p">{}</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;hiz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">hiz</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;loz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">hiz</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="c1"># Stars</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">],</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">,</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="c1"># QSOs</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;loz&#39;</span><span class="p">,</span><span class="s1">&#39;hiz&#39;</span><span class="p">],[</span><span class="s1">&#39;(z &lt; 2.1)&#39;</span><span class="p">,</span><span class="s1">&#39;(z &gt; 2.1)&#39;</span><span class="p">],[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">]):</span>
			<span class="n">i</span><span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
			<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		
		<span class="c1">#for xlim,ylim,x_lab,y_lab in ax[0].set_xlim([-0.5,3.])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x1_qso&#39;</span><span class="p">])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x2_qso&#39;</span><span class="p">])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y1_qso&#39;</span><span class="p">])</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y2_qso&#39;</span><span class="p">])</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
		<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g-z&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
		<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W&#39;</span><span class="p">)</span>
		<span class="n">leg</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.02</span><span class="p">),</span><span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
		<span class="c1">## Add box</span>
		<span class="c1">#ts= TSBox(src=&#39;LRG&#39;)</span>
		<span class="c1">#xrange,yrange= xyrange[&#39;x_lrg&#39;],xyrange[&#39;y_lrg&#39;]</span>
		<span class="c1">#ts.add_ts_box(ax[cnt], xlim=xrange,ylim=yrange)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_QSO.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">plot_FDR_multipanel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Data</span>
		<span class="n">qsos</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qsos</span><span class="p">()</span>
		<span class="n">star_obj</span><span class="o">=</span> <span class="n">STAR</span><span class="p">(</span><span class="n">DR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DR</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="n">stars</span><span class="o">=</span> <span class="n">star_obj</span><span class="o">.</span><span class="n">get_purestars</span><span class="p">()</span>
		<span class="n">hiz</span><span class="o">=</span><span class="mf">2.1</span>
		<span class="n">index</span><span class="o">=</span><span class="p">{}</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;hiz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">hiz</span>
		<span class="n">index</span><span class="p">[</span><span class="s1">&#39;loz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">hiz</span>
		<span class="c1"># Plot</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="c1"># Stars top panel</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">],</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span>\
					  <span class="n">stars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">,</span>\
					  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stars&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="c1"># QSOs loz middle, hiz bottom</span>
		<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="s1">&#39;loz&#39;</span><span class="p">,</span><span class="s1">&#39;hiz&#39;</span><span class="p">],[</span><span class="s1">&#39;(z &lt; 2.1)&#39;</span><span class="p">,</span><span class="s1">&#39;(z &gt; 2.1)&#39;</span><span class="p">],[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">]):</span>
			<span class="n">i</span><span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
			<span class="n">W</span><span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wise_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">qsos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mag_nodust&#39;</span><span class="p">)[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>\
						  <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;qso &#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
			<span class="c1">#for xlim,ylim,x_lab,y_lab in ax[0].set_xlim([-0.5,3.])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x1_qso&#39;</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;x2_qso&#39;</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y1_qso&#39;</span><span class="p">])</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xyrange</span><span class="p">[</span><span class="s1">&#39;y2_qso&#39;</span><span class="p">])</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
			<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g-z&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
			<span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r-W&#39;</span><span class="p">)</span>
		<span class="c1">#leg=ax[0,0].legend(loc=(0,1.02),scatterpoints=1,ncol=3,markerscale=2)</span>
		<span class="c1">## Add box</span>
		<span class="c1">#ts= TSBox(src=&#39;LRG&#39;)</span>
		<span class="c1">#xrange,yrange= xyrange[&#39;x_lrg&#39;],xyrange[&#39;y_lrg&#39;]</span>
		<span class="c1">#ts.add_ts_box(ax[cnt], xlim=xrange,ylim=yrange)</span>
		<span class="n">name</span><span class="o">=</span><span class="s1">&#39;dr</span><span class="si">%d</span><span class="s1">_FDR_QSO_multi.png&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">DR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>\
						<span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">leg</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>



	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot_FDR_multipanel</span><span class="p">()</span>

                        
                        


<span class="k">def</span> <span class="nf">plot_tractor_galfit_shapes</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">keep</span><span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="n">keep</span><span class="p">],</span> <span class="n">cat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)[</span><span class="n">keep</span><span class="p">],</span>
                   <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;galfit_hi_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">ylab</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;tractor_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">savenm</span><span class="o">=</span> <span class="s1">&#39;tractor_galfit_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savenm</span><span class="p">,</span><span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">savenm</span><span class="p">)</span>
 
<span class="c1"># 2D plots</span>




<div class="viewcode-block" id="GalaxyPrior"><a class="viewcode-back" href="../../index.html#obiwan.priors.GalaxyPrior">[docs]</a><span class="k">class</span> <span class="nc">GalaxyPrior</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Stores all 4 galaxy type classes&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1">#self.qso= QSO()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">star</span><span class="o">=</span> <span class="n">STAR</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lrg</span><span class="o">=</span> <span class="n">LRG</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">elg</span><span class="o">=</span> <span class="n">ELG</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">plot_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1">#self.qso.plot()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">star</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lrg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">elg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<span class="k">def</span> <span class="nf">get_parser</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>\
                                     <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Generate a legacypipe-compatible CCDs file </span><span class="se">\</span>
<span class="s1">                                                  from a set of reduced imaging.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--outdir&#39;</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;where to write KDE fits and QA plots&#39;</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span>
 

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span><span class="o">=</span> <span class="n">get_parser</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">elg</span><span class="o">=</span> <span class="n">EmptyClass</span><span class="p">()</span>
    
    <span class="n">d</span><span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;/home/kaylan/mydata/priors_data&#39;</span>
    <span class="n">d</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
    <span class="n">elg</span><span class="o">.</span><span class="n">data</span><span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">load_elg</span><span class="p">(</span><span class="n">DR</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">elg</span><span class="o">.</span><span class="n">model</span><span class="o">=</span> <span class="n">KDE_Model</span><span class="p">(</span><span class="s1">&#39;elg&#39;</span><span class="p">,</span><span class="n">elg</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">outdir</span><span class="p">)</span>
    <span class="n">elg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">kde</span><span class="o">=</span> <span class="n">elg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_kde</span><span class="p">()</span>

    <span class="n">p</span><span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">elg</span><span class="p">(</span><span class="n">elg</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">elg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">df_wcut</span><span class="p">,</span><span class="n">elg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">df_for_kde</span><span class="p">,</span>
          <span class="n">elg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">kde</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">)</span>

    <span class="c1">#elg.plot_FDR()</span>
    <span class="c1">#elg.plot_FDR_multi()</span>
    <span class="c1">#elg.plot_obiwan_multi()</span>
    <span class="c1">#elg.plot_FDR_mag_dist()</span>
    <span class="c1">#elg.plot_obiwan_mag_dist()</span>
    <span class="c1">#elg.plot_LRG_FDR_wELG_data()</span>
    <span class="c1">#elg.plot_FDR_multipanel()</span>
    <span class="c1">#elg.get_acs_matched_deep2()</span>
    <span class="c1">#elg.plot_dr3_acs_deep2()</span>
    <span class="c1">#elg.plot_kde_shapes()</span>
    <span class="c1">#elg.plot_kde()</span>
    <span class="c1">#elg.plot_redshift()</span>
    <span class="c1">#elg.cross_validate_redshift()</span>

    <span class="c1">#elg.plot_kde()</span>
    <span class="c1">#elg.plot()</span>
    <span class="c1">#lrg.plot_dr3_cosmos_acs()</span>
    <span class="c1">#lrg.plot_FDR()</span>
    <span class="c1">#lrg.plot_FDR_multi()</span>
    <span class="c1">#lrg.plot_obiwan_multi()</span>
    <span class="c1">#lrg.plot_FDR_mag_dist()</span>
    <span class="c1">#lrg.plot_obiwan_mag_dist()</span>
    <span class="c1">#lrg.plot_LRG_FDR_mag_dist()</span>
    <span class="c1">#lrg.plot_LRGs_in_ELG_FDR()</span>
    <span class="c1">#lrg.plot_FDR()</span>
    <span class="c1">#lrg.plot_FDR_multipanel()</span>
    <span class="c1">#lrg.plot_kde_shapes()</span>
    <span class="c1">#lrg.plot_kde()</span>
    <span class="c1">#lrg.plot()</span>

    

    

    
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2017, DESI Collaboration.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>